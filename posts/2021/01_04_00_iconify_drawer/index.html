<!doctype html><html lang="ja"><head><meta charset="utf-8"><link crossorigin="anonymous" media="all" rel="stylesheet" href="https://suihan74.github.io/css/frameworks.css?20211121180857"><link crossorigin="anonymous" media="all" rel="stylesheet" href="https://suihan74.github.io/css/github.css?20211121180857"><link crossorigin="anonymous" media="all" rel="stylesheet" href="https://suihan74.github.io/css/user.css?20211121180857"><link crossorigin="anonymous" media="all" rel="stylesheet" href="https://suihan74.github.io/css/lightbox.css"><link crossorigin="anonymous" media="all" rel="stylesheet" href="https://suihan74.github.io/css/syntax-highlight.css"><meta name="viewport" content="width=device-width"><meta name="description" content="MotionLayoutを使ってアイコン化可能なDrawerLayout風のものを作る例"><meta name="keywords" content="Android,Kotlin,MotionLayout"><link rel="canonical" href="https://suihan74.github.io/posts/2021/01_04_00_iconify_drawer/"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="アイコン化可能なドロワーをでっち上げる - すいはんぶろぐ.io"><meta name="twitter:description" content="MotionLayoutを使ってアイコン化可能なDrawerLayout風のものを作る例"><meta name="twitter:site" content="https://suihan74.github.io/"><meta name="twitter:creator" content><meta name="twitter:image" content="https://suihan74.github.io/"><meta property="og:url" content="https://suihan74.github.io/posts/2021/01_04_00_iconify_drawer/"><meta property="og:site_name" content="すいはんぶろぐ.io"><meta property="og:type" content="article"><meta property="og:title" content="アイコン化可能なドロワーをでっち上げる"><meta property="og:description" content="MotionLayoutを使ってアイコン化可能なDrawerLayout風のものを作る例"><meta property="article:published_time" content="2021-01-04 17:42:49 +0900 JST"><title>アイコン化可能なドロワーをでっち上げる - すいはんぶろぐ.io</title><link rel="icon" type="image/x-icon" class="js-site-favicon" href="https://suihan74.github.io/favicon.ico"><link rel="shortcut icon" href="https://suihan74.github.io/favicon.ico"><meta name="theme-color" content="#1e2327"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-71542625-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-71542625-2');</script></head><body class="env-production emoji-size-boost page-responsive page-profile"><div class="position-relative js-header-wrapper"><span class="Progress progress-pjax-loader position-fixed width-full js-pjax-loader-bar"><span class="progress-pjax-loader-bar top-0 left-0" style="width:0%"></span></span><header class="Header py-lg-0 js-details-container Details flex-wrap flex-lg-nowrap p-responsive" role="banner"><div class="Header-item d-none d-lg-flex"><a class="Header-link" href="https://suihan74.github.io/" aria-label="Homepage" data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1" width="32" aria-hidden="true">
                    <path style="fill-rule:evenodd" d="M 8,0 C 3.58,0 0,3.58 0,8 c 0,3.54 2.29,6.53 5.47,7.59 0.4,0.07 0.55,-0.17 0.55,-0.38 0,-0.19 -0.077797,-1.481017 -0.077797,-2.151017 C 5.9433346,12.597005 6.1160655,11.824118 6.56,11.53 4.78,11.33 3.8013559,10.978983 3.5810169,7.6647458 3.9355372,4.6446549 5.3653277,3.8240736 8.0538984,3.639661 10.967753,3.8102868 12.141357,4.4459308 12.425085,7.6477967 12.255593,10.378813 11.25,11.33 9.47,11.53 c 0.29,0.25 0.54,0.73 0.54,1.48 0,1.07 -0.01,1.93 -0.01,2.2 0,0.21 0.15,0.46 0.55,0.38 C 13.806446,14.490656 15.999121,11.437004 16,8 16,3.58 12.42,0 8,0 Z" />
                    <rect style="fill-rule:evenodd" ry="0.23728813" y="6.3898306" x="6.0169492" height="1.0847455" width="3.9830508"/>
                </svg><span class="site-title-text">すいはんぶろぐ.io</span></a></div><div class="Header-item Header-item--full flex-column flex-lg-row width-full flex-order-2 flex-lg-order-none mr-0 mr-lg-3 mt-3 mt-lg-0 Details-content--hidden"><div class="header-search flex-self-stretch flex-lg-self-auto mr-0 mr-lg-3 mb-3 mb-lg-0 scoped-search site-scoped-search js-site-search position-relative js-jump-to" role="combobox" aria-owns="jump-to-results" aria-label="Search or jump to" aria-haspopup="listbox" aria-expanded="false"><div class="position-relative"></div></div></div><nav class="d-flex" aria-label="Global"><a class="js-selected-navigation-item Header-link py-lg-3">&nbsp;</a></nav><div class="Header-item Header-item--full flex-justify-center d-lg-none position-relative" style="margin-right:auto"><a class="Header-link" href="https://suihan74.github.io/" aria-label="Homepage" data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1"
                    width="32" aria-hidden="true">
                    <path style="fill-rule:evenodd" d="M 8,0 C 3.58,0 0,3.58 0,8 c 0,3.54 2.29,6.53 5.47,7.59 0.4,0.07 0.55,-0.17 0.55,-0.38 0,-0.19 -0.077797,-1.481017 -0.077797,-2.151017 C 5.9433346,12.597005 6.1160655,11.824118 6.56,11.53 4.78,11.33 3.8013559,10.978983 3.5810169,7.6647458 3.9355372,4.6446549 5.3653277,3.8240736 8.0538984,3.639661 10.967753,3.8102868 12.141357,4.4459308 12.425085,7.6477967 12.255593,10.378813 11.25,11.33 9.47,11.53 c 0.29,0.25 0.54,0.73 0.54,1.48 0,1.07 -0.01,1.93 -0.01,2.2 0,0.21 0.15,0.46 0.55,0.38 C 13.806446,14.490656 15.999121,11.437004 16,8 16,3.58 12.42,0 8,0 Z" />
                    <rect style="fill-rule:evenodd" ry="0.23728813" y="6.3898306" x="6.0169492" height="1.0847455" width="3.9830508"/>
                </svg><span class="site-title-text">すいはんぶろぐ.io</span></a></div><div class="Header-item position-relative mr-0 d-none d-lg-flex Details-content--hidden"><div class="header-search flex-self-stretch flex-lg-self-auto mr-0 mr-lg-3 mb-3 mb-lg-0 position-relative js-jump-to"><div class="position-relative"><form class="js-site-search-form" role="search" action="https://cse.google.com/cse" method="get"><input type="hidden" name="cx" value="006598476776954487838:x6qvcxfxgqt">
<label class="form-control input-sm header-search-wrapper p-0 header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center js-chromeless-input-container"><input type="text" class="header-search-form form-control input-sm header-search-input jump-to-field js-jump-to-field" name="q" placeholder="Search" autocapitalize="off" aria-label="Search" spellcheck="false" onkeydown="if(event.keyCode==13){if(this.value.length){document.getElementById('header-search-submit').click();return false}else{return false}};" autocomplete="off">
<button id="header-search-submit" class="mr-1 ml-1 header-search-button" type="submit"><svg class="header-search-button-icon" width="13" height="13" viewBox="0 0 13 13">
                                    <title>サイト内検索</title>
                                    <path d="m4.8495 7.8226c0.82666 0 1.5262-0.29146 2.0985-0.87438 0.57232-0.58292 0.86378-1.2877 0.87438-2.1144 0.010599-0.82666-0.28086-1.5262-0.87438-2.0985-0.59352-0.57232-1.293-0.86378-2.0985-0.87438-0.8055-0.010599-1.5103 0.28086-2.1144 0.87438-0.60414 0.59352-0.8956 1.293-0.87438 2.0985 0.021197 0.8055 0.31266 1.5103 0.87438 2.1144 0.56172 0.60414 1.2665 0.8956 2.1144 0.87438zm4.4695 0.2115 3.681 3.6819-1.259 1.284-3.6817-3.7 0.0019784-0.69479-0.090043-0.098846c-0.87973 0.76087-1.92 1.1413-3.1207 1.1413-1.3553 0-2.5025-0.46363-3.4417-1.3909s-1.4088-2.0686-1.4088-3.4239c0-1.3553 0.4696-2.4966 1.4088-3.4239 0.9392-0.92727 2.0864-1.3969 3.4417-1.4088 1.3553-0.011889 2.4906 0.45771 3.406 1.4088 0.9154 0.95107 1.379 2.0924 1.3909 3.4239 0 1.2126-0.38043 2.2588-1.1413 3.1385l0.098834 0.090049z"></path>
                                </svg></button></label></form></div></div></div></header></div><div id="start-of-content" class="show-on-focus"></div><div id="js-flash-container"></div><div class="application-main" data-commit-hovercards-enabled><div itemscope itemtype="http://schema.org/SoftwareSourceCode"><main id="js-repo-pjax-container" data-pjax-container><div class="pagehead repohead instapaper_ignore readability-menu experiment-repo-nav pt-lg-4"><div class="repohead-details-container clearfix container-lg p-responsive d-lg-block"><div class="d-flex"><h1 class="public css-truncate float-none flex-auto width-fit pl-0"><a class="avatar mr-1" href="https://suihan74.github.io/about/"><img src="/images/author.png" class="avatar-user" width="26" height="26" title="すいはん"></a>
<strong itemprop="name"><a href="https://suihan74.github.io/posts/2021/01_04_00_iconify_drawer/">アイコン化可能なドロワーをでっち上げる</a></strong><div class="text-small text-gray mb-1 mt-1">MotionLayoutを使ってアイコン化可能なDrawerLayout風のものを作る例</div><div class="text-small text-gray"><div class="f6 text-gray mt-1"><a class="muted-link mr-3 d-inline-block" href="/tags/android"><svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
  <path fill-rule="evenodd" d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z"></path>
</svg>Android</a>
<a class="muted-link mr-3 d-inline-block" href="/tags/kotlin"><svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
  <path fill-rule="evenodd" d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z"></path>
</svg>Kotlin</a>
<a class="muted-link mr-3 d-inline-block" href="/tags/motionlayout"><svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
  <path fill-rule="evenodd" d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z"></path>
</svg>MotionLayout</a></div></div><div class="d-block text-small text-gray"><span class="d-inline-block">Created at <time datetime="2021-01-04 17:42" class="no-wrap">2021-01-04 17:42</time></span>
<span class="file-info-divider"></span><span class="d-inline-block">Updated at <time datetime="2021-01-26 19:15" class="no-wrap">2021-01-26 19:15</time></span></div></h1></div></div></div><div class="container-lg clearfix new-discussion-timeline experiment-repo-nav p-responsive"><div class="repository-content"><div class="Box mt-3 position-relative"><div class="Box-header py-2 d-flex flex-column flex-shrink-0 flex-md-row flex-md-items-center"><div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">2023 Words</div><div class="d-flex py-1 py-md-0 flex-auto flex-order-1 flex-md-order-2 flex-sm-grow-0 flex-justify-between"><div class="BtnGroup"><a rel="nofollow" class="btn btn-sm BtnGroup-item" href="https://github.com/suihan74/hugo_files/commits/master/content/posts/2021/01_04_00_iconify_drawer.md">History</a></div></div></div><div id="readme" class="Box-body readme blob instapaper_body js-code-block-container"><article class="markdown-body entry-content p-3 p-md-6" itemprop="text"><h2 id="追記-2021-01-26">追記 (2021-01-26)<a class="anchor" aria-hidden="true" href="#追記-2021-01-26"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><p>メニュー開閉時に仮想キーボードを閉じるためのコードを追加<br>(該当位置は
<a href="https://github.com/suihan74/hugo_files/commit/847804ab21e23ca38bf6f0c100f9a32688837a8f" target="_blank" rel="noopener">commit: 847804a</a>
を参照)</p><hr><h2 id="なにこれ">なにこれ<a class="anchor" aria-hidden="true" href="#なにこれ"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><a href="/images/2021/01_04_00/sample.gif" data-lightbox="images" data-title="アイコン化可能なドロワー"><img border="0" src="/images/2021/01_04_00/sample.gif" title="アイコン化可能なドロワー" style="zoom:.8"></a><p>こんなの。</p><p>画面横幅の狭いスマホ用レイアウトでこういうことをするのは恐らく非推奨で、おとなしくツールバーにハンバーガーボタンでも置いておけという話なのかもしれないが、やりたくなったのだから仕方がない。</p><p>最初のサンプルのアプリは最近作ってるこれ。</p><p><a href="https://github.com/suihan74/NotificationReporter" target="_blank" rel="noopener">suihan74/NotificationReporter: 消灯後の画面に通知LED代わりのものとかを表示するやつ</a></p><p>実際に今回の内容使ってる部分のコードはここ。</p><p><a href="https://github.com/suihan74/NotificationReporter/tree/main/app/src/main/java/com/suihan74/notificationreporter/scenes/preferences" target="_blank" rel="noopener">NotificationReporter/app/src/main/java/com/suihan74/notificationreporter/scenes/preferences at main · suihan74/NotificationReporter</a></p><h2 id="実装例">実装例<a class="anchor" aria-hidden="true" href="#実装例"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><h3 id="レイアウト">レイアウト<a class="anchor" aria-hidden="true" href="#レイアウト"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><div class="highlight"><pre class="chroma"><code class="language-xml:layout/activity_hoge.xml" data-lang="xml:layout/activity_hoge.xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
<span class="nt">&lt;layout&gt;</span>
    <span class="nt">&lt;data&gt;</span>
        <span class="nt">&lt;variable</span>
            <span class="na">name=</span><span class="s">&#34;vm&#34;</span>
            <span class="na">type=</span><span class="s">&#34;com.suihan74.example.HogeViewModel&#34;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/data&gt;</span>

    <span class="nt">&lt;androidx.constraintlayout.widget.ConstraintLayout</span>
        <span class="na">xmlns:android=</span><span class="s">&#34;http://schemas.android.com/apk/res/android&#34;</span>
        <span class="na">xmlns:app=</span><span class="s">&#34;http://schemas.android.com/apk/res-auto&#34;</span>
        <span class="na">android:id=</span><span class="s">&#34;@+id/mainLayout&#34;</span>
        <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
        <span class="na">android:layout_height=</span><span class="s">&#34;match_parent&#34;</span><span class="nt">&gt;</span>

        <span class="nt">&lt;androidx.constraintlayout.motion.widget.MotionLayout</span>
            <span class="na">android:id=</span><span class="s">&#34;@+id/motionLayout&#34;</span>
            <span class="na">android:background=</span><span class="s">&#34;@android:color/transparent&#34;</span>
            <span class="na">app:layoutDescription=</span><span class="s">&#34;@xml/motion_menu_toggle&#34;</span>
            <span class="na">app:layout_constraintTop_toTopOf=</span><span class="s">&#34;parent&#34;</span>
            <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">&#34;parent&#34;</span>
            <span class="na">app:layout_constraintStart_toStartOf=</span><span class="s">&#34;parent&#34;</span>
            <span class="na">app:layout_constraintEnd_toEndOf=</span><span class="s">&#34;parent&#34;</span>
            <span class="na">android:layout_width=</span><span class="s">&#34;0dp&#34;</span>
            <span class="na">android:layout_height=</span><span class="s">&#34;0dp&#34;</span><span class="nt">&gt;</span>

            <span class="c">&lt;!-- 画面右側に表示するコンテンツ部分 --&gt;</span>
            <span class="c">&lt;!-- 今回は選択中のメニュー項目にあわせてFragmentを切り替える --&gt;</span>
            <span class="nt">&lt;androidx.viewpager2.widget.ViewPager2</span>
                <span class="na">android:id=</span><span class="s">&#34;@+id/contentPager&#34;</span>
                <span class="na">currentItem=</span><span class="s">&#34;@={vm.selectedMenuItem}&#34;</span>
                <span class="na">android:layout_width=</span><span class="s">&#34;0dp&#34;</span>
                <span class="na">android:layout_height=</span><span class="s">&#34;0dp&#34;</span>
                <span class="na">android:layout_marginStart=</span><span class="s">&#34;@dimen/menuWidthCompact&#34;</span>
                <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">&#34;parent&#34;</span>
                <span class="na">app:layout_constraintStart_toStartOf=</span><span class="s">&#34;parent&#34;</span>
                <span class="na">app:layout_constraintEnd_toEndOf=</span><span class="s">&#34;parent&#34;</span>
                <span class="na">app:layout_constraintTop_toTopOf=</span><span class="s">&#34;parent&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/androidx.viewpager2.widget.ViewPager2&gt;</span>

            <span class="c">&lt;!-- メニュー表示中の背景 --&gt;</span>
            <span class="nt">&lt;View</span>
                <span class="na">android:id=</span><span class="s">&#34;@+id/clickGuard&#34;</span>
                <span class="na">android:background=</span><span class="s">&#34;#99000000&#34;</span>
                <span class="na">app:layout_constraintStart_toStartOf=</span><span class="s">&#34;parent&#34;</span>
                <span class="na">app:layout_constraintEnd_toEndOf=</span><span class="s">&#34;parent&#34;</span>
                <span class="na">app:layout_constraintTop_toTopOf=</span><span class="s">&#34;parent&#34;</span>
                <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">&#34;parent&#34;</span>
                <span class="na">android:layout_width=</span><span class="s">&#34;0dp&#34;</span>
                <span class="na">android:layout_height=</span><span class="s">&#34;0dp&#34;</span><span class="nt">/&gt;</span>

            <span class="c">&lt;!-- メニュー部分 --&gt;</span>
            <span class="nt">&lt;androidx.recyclerview.widget.RecyclerView</span>
                <span class="na">android:id=</span><span class="s">&#34;@+id/menuRecyclerView&#34;</span>
                <span class="na">style=</span><span class="s">&#34;@style/RecyclerView.Linear&#34;</span>
                <span class="na">android:background=</span><span class="s">&#34;@color/menuBackground&#34;</span>
                <span class="na">android:elevation=</span><span class="s">&#34;16dp&#34;</span>
                <span class="na">app:layout_constraintStart_toStartOf=</span><span class="s">&#34;parent&#34;</span>
                <span class="na">app:layout_constraintTop_toTopOf=</span><span class="s">&#34;parent&#34;</span>
                <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">&#34;parent&#34;</span>
                <span class="na">android:layout_width=</span><span class="s">&#34;@dimen/menuWidthCompact&#34;</span>
                <span class="na">android:layout_height=</span><span class="s">&#34;0dp&#34;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/androidx.recyclerview.widget.RecyclerView&gt;</span>

        <span class="nt">&lt;/androidx.constraintlayout.motion.widget.MotionLayout&gt;</span>
    <span class="nt">&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span>

    <span class="c">&lt;!-- より前面に表示するものがあればこの辺に --&gt;</span>
    ...
<span class="nt">&lt;/layout&gt;</span>
</code></pre></div><p>メニュー部分と、メニュー最大化中に表示する背景の他、それらより下に表示する(タッチを処理する必要がある)ものはすべて<code>MotionLayout</code>の子にする。</p><h3 id="motionscene">MotionScene<a class="anchor" aria-hidden="true" href="#motionscene"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><div class="highlight"><pre class="chroma"><code class="language-xml:xml/motion_menu_toggle.xml" data-lang="xml:xml/motion_menu_toggle.xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
<span class="c">&lt;!--
</span><span class="c">    メニュードロワ部分を常にアイコン表示、右にスワイプして詳細表示にする
</span><span class="c">--&gt;</span>
<span class="nt">&lt;MotionScene</span>
    <span class="na">xmlns:android=</span><span class="s">&#34;http://schemas.android.com/apk/res/android&#34;</span>
    <span class="na">xmlns:motion=</span><span class="s">&#34;http://schemas.android.com/apk/res-auto&#34;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!-- メニュー部分横スワイプでメニュー開閉 --&gt;</span>
    <span class="nt">&lt;Transition</span>
        <span class="na">motion:constraintSetStart=</span><span class="s">&#34;@id/compact&#34;</span>
        <span class="na">motion:constraintSetEnd=</span><span class="s">&#34;@id/full&#34;</span><span class="nt">&gt;</span>

        <span class="nt">&lt;OnSwipe</span>
            <span class="na">motion:touchAnchorId=</span><span class="s">&#34;@+id/menuRecyclerView&#34;</span>
            <span class="na">motion:touchRegionId=</span><span class="s">&#34;@+id/menuRecyclerView&#34;</span>
            <span class="na">motion:onTouchUp=</span><span class="s">&#34;autoComplete&#34;</span>
            <span class="na">motion:maxAcceleration=</span><span class="s">&#34;80&#34;</span>
            <span class="na">motion:touchAnchorSide=</span><span class="s">&#34;end&#34;</span>
            <span class="na">motion:dragDirection=</span><span class="s">&#34;dragEnd&#34;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/Transition&gt;</span>

    <span class="c">&lt;!-- 背景クリックで閉じる --&gt;</span>
    <span class="nt">&lt;Transition</span>
        <span class="na">motion:constraintSetEnd=</span><span class="s">&#34;@id/compact&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;OnClick</span>
            <span class="na">motion:targetId=</span><span class="s">&#34;@+id/clickGuard&#34;</span>
            <span class="na">motion:clickAction=</span><span class="s">&#34;transitionToEnd&#34;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/Transition&gt;</span>

    <span class="c">&lt;!-- 最小状態(アイコン化) --&gt;</span>
    <span class="nt">&lt;ConstraintSet</span> <span class="na">android:id=</span><span class="s">&#34;@+id/compact&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Constraint</span>
            <span class="na">android:id=</span><span class="s">&#34;@id/clickGuard&#34;</span>
            <span class="na">android:visibility=</span><span class="s">&#34;invisible&#34;</span>
            <span class="na">android:layout_width=</span><span class="s">&#34;0dp&#34;</span>
            <span class="na">android:layout_height=</span><span class="s">&#34;0dp&#34;</span>
            <span class="na">motion:layout_constraintTop_toTopOf=</span><span class="s">&#34;parent&#34;</span>
            <span class="na">motion:layout_constraintBottom_toBottomOf=</span><span class="s">&#34;parent&#34;</span>
            <span class="na">motion:layout_constraintStart_toStartOf=</span><span class="s">&#34;parent&#34;</span>
            <span class="na">motion:layout_constraintEnd_toEndOf=</span><span class="s">&#34;parent&#34;</span> <span class="nt">/&gt;</span>

        <span class="nt">&lt;Constraint</span>
            <span class="na">android:id=</span><span class="s">&#34;@id/menuRecyclerView&#34;</span>
            <span class="na">android:layout_width=</span><span class="s">&#34;@dimen/menuWidthCompact&#34;</span>
            <span class="na">android:layout_height=</span><span class="s">&#34;0dp&#34;</span>
            <span class="na">motion:layout_constraintTop_toTopOf=</span><span class="s">&#34;parent&#34;</span>
            <span class="na">motion:layout_constraintBottom_toBottomOf=</span><span class="s">&#34;parent&#34;</span>
            <span class="na">motion:layout_constraintStart_toStartOf=</span><span class="s">&#34;parent&#34;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/ConstraintSet&gt;</span>

    <span class="c">&lt;!-- 最大状態(コンテンツとメニューの間に背景表示してメニュー横幅を最大化) --&gt;</span>
    <span class="nt">&lt;ConstraintSet</span> <span class="na">android:id=</span><span class="s">&#34;@+id/full&#34;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;Constraint</span>
            <span class="na">android:id=</span><span class="s">&#34;@id/clickGuard&#34;</span>
            <span class="na">android:visibility=</span><span class="s">&#34;visible&#34;</span>
            <span class="na">android:layout_width=</span><span class="s">&#34;0dp&#34;</span>
            <span class="na">android:layout_height=</span><span class="s">&#34;0dp&#34;</span>
            <span class="na">motion:layout_constraintTop_toTopOf=</span><span class="s">&#34;parent&#34;</span>
            <span class="na">motion:layout_constraintBottom_toBottomOf=</span><span class="s">&#34;parent&#34;</span>
            <span class="na">motion:layout_constraintStart_toStartOf=</span><span class="s">&#34;parent&#34;</span>
            <span class="na">motion:layout_constraintEnd_toEndOf=</span><span class="s">&#34;parent&#34;</span> <span class="nt">/&gt;</span>

        <span class="nt">&lt;Constraint</span>
            <span class="na">android:id=</span><span class="s">&#34;@id/menuRecyclerView&#34;</span>
            <span class="na">android:layout_width=</span><span class="s">&#34;@dimen/menuWidthFull&#34;</span>
            <span class="na">android:layout_height=</span><span class="s">&#34;0dp&#34;</span>
            <span class="na">motion:layout_constraintTop_toTopOf=</span><span class="s">&#34;parent&#34;</span>
            <span class="na">motion:layout_constraintBottom_toBottomOf=</span><span class="s">&#34;parent&#34;</span>
            <span class="na">motion:layout_constraintStart_toStartOf=</span><span class="s">&#34;parent&#34;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/ConstraintSet&gt;</span>

<span class="nt">&lt;/MotionScene&gt;</span>
</code></pre></div><h3 id="メニュー項目のレイアウト">メニュー項目のレイアウト<a class="anchor" aria-hidden="true" href="#メニュー項目のレイアウト"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
<span class="nt">&lt;layout&gt;</span>
    <span class="nt">&lt;data&gt;</span>
        <span class="nt">&lt;import</span> <span class="na">type=</span><span class="s">&#34;androidx.lifecycle.LiveData&#34;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;import</span> <span class="na">type=</span><span class="s">&#34;com.suihan74.example.MenuItem&#34;</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;variable</span>
            <span class="na">name=</span><span class="s">&#34;item&#34;</span>
            <span class="na">type=</span><span class="s">&#34;MenuItem&#34;</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;variable</span>
            <span class="na">name=</span><span class="s">&#34;selectedItem&#34;</span>
            <span class="na">type=</span><span class="s">&#34;LiveData&amp;lt;MenuItem&amp;gt;&#34;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/data&gt;</span>

    <span class="nt">&lt;FrameLayout</span>
        <span class="na">xmlns:android=</span><span class="s">&#34;http://schemas.android.com/apk/res/android&#34;</span>
        <span class="na">xmlns:app=</span><span class="s">&#34;http://schemas.android.com/apk/res-auto&#34;</span>
        <span class="na">android:background=</span><span class="s">&#34;@{selectedItem == item ? @color/selectedMenuItemBackground : @android:color/transparent}&#34;</span>
        <span class="na">android:elevation=</span><span class="s">&#34;@{selectedItem == item ? 48f : 0f}&#34;</span>
        <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
        <span class="na">android:layout_height=</span><span class="s">&#34;wrap_content&#34;</span><span class="nt">&gt;</span>

        <span class="nt">&lt;androidx.constraintlayout.widget.ConstraintLayout</span>
            <span class="na">android:background=</span><span class="s">&#34;?selectableItemBackground&#34;</span>
            <span class="na">android:paddingHorizontal=</span><span class="s">&#34;@dimen/menuIconPadding&#34;</span>
            <span class="na">android:paddingVertical=</span><span class="s">&#34;@dimen/menuIconPadding&#34;</span>
            <span class="na">android:layout_width=</span><span class="s">&#34;match_parent&#34;</span>
            <span class="na">android:layout_height=</span><span class="s">&#34;wrap_content&#34;</span><span class="nt">&gt;</span>

            <span class="nt">&lt;ImageView</span>
                <span class="na">android:id=</span><span class="s">&#34;@+id/icon&#34;</span>
                <span class="na">src=</span><span class="s">&#34;@{item.iconId}&#34;</span>
                <span class="na">app:tint=</span><span class="s">&#34;?android:textColor&#34;</span>
                <span class="na">android:background=</span><span class="s">&#34;@android:color/transparent&#34;</span>
                <span class="na">android:contentDescription=</span><span class="s">&#34;@null&#34;</span>
                <span class="na">app:layout_constraintStart_toStartOf=</span><span class="s">&#34;parent&#34;</span>
                <span class="na">app:layout_constraintTop_toTopOf=</span><span class="s">&#34;parent&#34;</span>
                <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">&#34;parent&#34;</span>
                <span class="na">android:layout_width=</span><span class="s">&#34;@dimen/menuIconSize&#34;</span>
                <span class="na">android:layout_height=</span><span class="s">&#34;@dimen/menuIconSize&#34;</span><span class="nt">/&gt;</span>

            <span class="nt">&lt;TextView</span>
                <span class="na">android:id=</span><span class="s">&#34;@+id/label&#34;</span>
                <span class="na">textId=</span><span class="s">&#34;@{item.labelId}&#34;</span>
                <span class="na">android:background=</span><span class="s">&#34;@android:color/transparent&#34;</span>
                <span class="na">android:textSize=</span><span class="s">&#34;18sp&#34;</span>
                <span class="na">android:singleLine=</span><span class="s">&#34;true&#34;</span>
                <span class="na">android:ellipsize=</span><span class="s">&#34;none&#34;</span>
                <span class="na">app:layout_constraintStart_toEndOf=</span><span class="s">&#34;@id/icon&#34;</span>
                <span class="na">app:layout_constraintEnd_toEndOf=</span><span class="s">&#34;parent&#34;</span>
                <span class="na">app:layout_constraintTop_toTopOf=</span><span class="s">&#34;parent&#34;</span>
                <span class="na">app:layout_constraintBottom_toBottomOf=</span><span class="s">&#34;parent&#34;</span>
                <span class="na">android:layout_marginStart=</span><span class="s">&#34;12dp&#34;</span>
                <span class="na">android:layout_width=</span><span class="s">&#34;0dp&#34;</span>
                <span class="na">android:layout_height=</span><span class="s">&#34;wrap_content&#34;</span><span class="nt">/&gt;</span>

        <span class="nt">&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span>
    <span class="nt">&lt;/FrameLayout&gt;</span>
<span class="nt">&lt;/layout&gt;</span>
</code></pre></div><h3 id="dimens">dimens<a class="anchor" aria-hidden="true" href="#dimens"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><div class="highlight"><pre class="chroma"><code class="language-xml:values/dimens.xml" data-lang="xml:values/dimens.xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
<span class="nt">&lt;resources&gt;</span>
    <span class="c">&lt;!-- メニュー部分を閉じているときの横幅 --&gt;</span>
    <span class="nt">&lt;dimen</span> <span class="na">name=</span><span class="s">&#34;menuWidthCompact&#34;</span><span class="nt">&gt;</span>48dp<span class="nt">&lt;/dimen&gt;</span>
    <span class="c">&lt;!-- メニュー部分を開いているときの横幅 --&gt;</span>
    <span class="nt">&lt;dimen</span> <span class="na">name=</span><span class="s">&#34;menuWidthFull&#34;</span><span class="nt">&gt;</span>256dp<span class="nt">&lt;/dimen&gt;</span>

    <span class="c">&lt;!-- メニューアイコンサイズ --&gt;</span>
    <span class="nt">&lt;dimen</span> <span class="na">name=</span><span class="s">&#34;menuIconSize&#34;</span><span class="nt">&gt;</span>24dp<span class="nt">&lt;/dimen&gt;</span>
    <span class="c">&lt;!-- メニューアイコンパディング(2倍してmenuIconSizeと足したらmenuWidthCompactになるようにする) --&gt;</span>
    <span class="nt">&lt;dimen</span> <span class="na">name=</span><span class="s">&#34;menuIconPadding&#34;</span><span class="nt">&gt;</span>12dp<span class="nt">&lt;/dimen&gt;</span>
<span class="nt">&lt;/resources&gt;</span>
</code></pre></div><h3 id="コード">コード<a class="anchor" aria-hidden="true" href="#コード"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><div class="highlight"><pre class="chroma"><code class="language-kt:HogeActivity.kt" data-lang="kt:HogeActivity.kt"><span class="k">class</span> <span class="nc">HogeActivity</span> <span class="p">:</span> <span class="n">AppCompatActivity</span><span class="p">()</span> <span class="p">{</span>

    <span class="c1">// `lazyProvideViewModel`は良い感じに`ViewModel`を生成するための拡張
</span><span class="c1"></span>    <span class="c1">// -&gt; https://suihan74.github.io/posts/2020/09_14_01_provide_view_model/
</span><span class="c1"></span>    <span class="k">val</span> <span class="py">viewModel</span> <span class="k">by</span> <span class="n">lazyProvideViewModel</span> <span class="p">{</span>
        <span class="n">HogeViewModel</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="c1">// ------ //
</span><span class="c1"></span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">:</span> <span class="n">Bundle</span><span class="p">?)</span> <span class="p">{</span>
        <span class="k">super</span><span class="p">.</span><span class="n">onCreate</span><span class="p">(</span><span class="n">savedInstanceState</span><span class="p">)</span>

        <span class="k">val</span> <span class="py">binding</span> <span class="p">=</span> <span class="n">ActivityHogeBinding</span><span class="p">.</span><span class="n">inflate</span><span class="p">(</span><span class="n">layoutInflater</span><span class="p">).</span><span class="n">also</span> <span class="p">{</span>
            <span class="n">it</span><span class="p">.</span><span class="n">vm</span> <span class="p">=</span> <span class="n">viewModel</span>
            <span class="n">it</span><span class="p">.</span><span class="n">lifecycleOwner</span> <span class="p">=</span> <span class="k">this</span>
        <span class="p">}</span>
        <span class="n">setContentView</span><span class="p">(</span><span class="n">binding</span><span class="p">.</span><span class="n">root</span><span class="p">)</span>

        <span class="c1">// ページ選択メニュー
</span><span class="c1"></span>        <span class="n">initializeMenu</span><span class="p">(</span><span class="n">binding</span><span class="p">)</span>

        <span class="c1">// ページビュー
</span><span class="c1"></span>        <span class="n">binding</span><span class="p">.</span><span class="n">contentPager</span><span class="p">.</span><span class="n">also</span> <span class="p">{</span> <span class="n">pager</span> <span class="p">-&gt;</span>
            <span class="n">pager</span><span class="p">.</span><span class="n">adapter</span> <span class="p">=</span> <span class="n">PageStateAdapter</span><span class="p">(</span><span class="n">supportFragmentManager</span><span class="p">,</span> <span class="n">lifecycle</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// ------ //
</span><span class="c1"></span>
    <span class="cm">/** ページ選択メニューの準備 */</span>
    <span class="k">private</span> <span class="k">fun</span> <span class="nf">initializeMenu</span><span class="p">(</span><span class="n">binding</span><span class="p">:</span> <span class="n">ActivityHogeBinding</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// メニュー項目を初期化
</span><span class="c1"></span>        <span class="k">val</span> <span class="py">list</span> <span class="p">=</span> <span class="n">binding</span><span class="p">.</span><span class="n">menuRecyclerView</span><span class="p">.</span><span class="n">also</span> <span class="p">{</span> <span class="n">list</span> <span class="p">-&gt;</span>
            <span class="c1">// 項目のDataBinding用に`ListAdapter&lt;T,VH&gt;`を拡張したやつ
</span><span class="c1"></span>            <span class="c1">// 関係ないので中身は割愛
</span><span class="c1"></span>            <span class="k">val</span> <span class="py">adapter</span> <span class="p">=</span> <span class="n">BindingListAdapter</span><span class="p">&lt;</span><span class="n">MenuItem</span><span class="p">,</span> <span class="n">ListItemHogeMenuBinding</span><span class="p">&gt;(</span>
                <span class="n">R</span><span class="p">.</span><span class="n">layout</span><span class="p">.</span><span class="n">list_item_hoge_menu</span><span class="p">,</span>
                <span class="k">this</span><span class="p">,</span>
                <span class="n">MenuItem</span><span class="p">.</span><span class="n">DiffCallback</span><span class="p">(),</span>
            <span class="p">)</span> <span class="p">{</span> <span class="n">binding</span><span class="p">,</span> <span class="n">item</span> <span class="p">-&gt;</span>
                <span class="n">binding</span><span class="p">.</span><span class="n">item</span> <span class="p">=</span> <span class="n">item</span>
                <span class="n">binding</span><span class="p">.</span><span class="n">selectedItem</span> <span class="p">=</span> <span class="n">viewModel</span><span class="p">.</span><span class="n">selectedMenuItem</span>
            <span class="p">}</span>

            <span class="n">list</span><span class="p">.</span><span class="n">adapter</span> <span class="p">=</span> <span class="n">adapter</span><span class="p">.</span><span class="n">apply</span> <span class="p">{</span>
                <span class="n">setOnClickItemListener</span> <span class="p">{</span> <span class="n">binding</span> <span class="p">-&gt;</span>
                    <span class="n">viewModel</span><span class="p">.</span><span class="n">selectedMenuItem</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="n">binding</span><span class="p">.</span><span class="n">item</span>
                <span class="p">}</span>

                <span class="c1">// リストにヘッダを追加するための`submitItems`の拡張
</span><span class="c1"></span>                <span class="c1">// 中身は割愛
</span><span class="c1"></span>                <span class="n">submit</span><span class="p">(</span>
                    <span class="n">items</span> <span class="p">=</span> <span class="n">MenuItem</span><span class="p">.</span><span class="n">values</span><span class="p">().</span><span class="n">toList</span><span class="p">(),</span>
                    <span class="n">header</span> <span class="p">=</span> <span class="p">{</span> <span class="n">parent</span> <span class="p">-&gt;</span>
                        <span class="c1">// 適当なheightを指定した空の`View`をヘッダとして生成
</span><span class="c1"></span>                        <span class="n">ListHeaderMenuBinding</span><span class="p">.</span><span class="n">inflate</span><span class="p">(</span><span class="n">layoutInflater</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="k">false</span><span class="p">).</span><span class="n">root</span><span class="p">.</span><span class="n">also</span> <span class="p">{</span>
                            <span class="n">it</span><span class="p">.</span><span class="n">setOnClickListener</span> <span class="p">{}</span>
                            <span class="n">it</span><span class="p">.</span><span class="n">setOnLongClickListener</span> <span class="p">{</span> <span class="k">false</span> <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// メニュー操作時に仮想キーボードを閉じる
</span><span class="c1"></span>        <span class="n">binding</span><span class="p">.</span><span class="n">motionLayout</span><span class="p">.</span><span class="n">setTransitionListener</span><span class="p">(</span><span class="k">object</span> <span class="err">: </span><span class="nc">MotionLayout</span><span class="p">.</span><span class="n">TransitionListener</span> <span class="p">{</span>
            <span class="k">override</span> <span class="k">fun</span> <span class="nf">onTransitionStarted</span><span class="p">(</span><span class="n">p0</span><span class="p">:</span> <span class="n">MotionLayout</span><span class="p">?,</span> <span class="n">p1</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">p2</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// 仮想キーボードを閉じてフォーカスをクリアする`View`の拡張関数
</span><span class="c1"></span>                <span class="c1">// 実装は割愛
</span><span class="c1"></span>                <span class="n">currentFocus</span><span class="o">?.</span><span class="n">hideSoftInputMethod</span><span class="p">(</span><span class="n">binding</span><span class="p">.</span><span class="n">mainLayout</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">override</span> <span class="k">fun</span> <span class="nf">onTransitionChange</span><span class="p">(</span><span class="n">p0</span><span class="p">:</span> <span class="n">MotionLayout</span><span class="p">?,</span> <span class="n">p1</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">p2</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">p3</span><span class="p">:</span> <span class="n">Float</span><span class="p">)</span> <span class="p">{}</span>
            <span class="k">override</span> <span class="k">fun</span> <span class="nf">onTransitionCompleted</span><span class="p">(</span><span class="n">p0</span><span class="p">:</span> <span class="n">MotionLayout</span><span class="p">?,</span> <span class="n">p1</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span> <span class="p">{}</span>
            <span class="k">override</span> <span class="k">fun</span> <span class="nf">onTransitionTrigger</span><span class="p">(</span><span class="n">p0</span><span class="p">:</span> <span class="n">MotionLayout</span><span class="p">?,</span> <span class="n">p1</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="n">p2</span><span class="p">:</span> <span class="n">Boolean</span><span class="p">,</span> <span class="n">p3</span><span class="p">:</span> <span class="n">Float</span><span class="p">)</span> <span class="p">{}</span>
        <span class="p">})</span>

        <span class="c1">// `MotionLayout`にタッチイベントを伝播させる
</span><span class="c1"></span>        <span class="c1">// リスト、各項目のタッチイベント処理で伝播が止まってしまうので、
</span><span class="c1"></span>        <span class="c1">// その前に明示的に`MotionLayout`にもイベントを送り付けるようにしている
</span><span class="c1"></span>
        <span class="n">list</span><span class="p">.</span><span class="n">setOnTouchListener</span> <span class="p">{</span> <span class="n">_</span><span class="p">,</span> <span class="n">motionEvent</span> <span class="p">-&gt;</span>
            <span class="n">binding</span><span class="p">.</span><span class="n">motionLayout</span><span class="p">.</span><span class="n">onTouchEvent</span><span class="p">(</span><span class="n">motionEvent</span><span class="p">)</span>
            <span class="k">return</span><span class="n">@setOnTouchListener</span> <span class="k">false</span>
        <span class="p">}</span>

        <span class="n">list</span><span class="p">.</span><span class="n">addOnItemTouchListener</span><span class="p">(</span><span class="k">object</span> <span class="err">: </span><span class="nc">RecyclerView</span><span class="p">.</span><span class="n">SimpleOnItemTouchListener</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">override</span> <span class="k">fun</span> <span class="nf">onInterceptTouchEvent</span><span class="p">(</span><span class="n">rv</span><span class="p">:</span> <span class="n">RecyclerView</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span> <span class="n">MotionEvent</span><span class="p">):</span> <span class="n">Boolean</span> <span class="p">{</span>
                <span class="n">binding</span><span class="p">.</span><span class="n">motionLayout</span><span class="p">.</span><span class="n">onTouchEvent</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                <span class="k">return</span> <span class="k">false</span>
            <span class="p">}</span>
        <span class="p">})</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p><code>RecyclerView</code>には空のクリックリスナを設定したヘッダを追加することで上部余白を調整するようにしているのだが、<br>これをしないで<code>RecyclerView</code>に<code>android:paddingTop="~~"</code>とかして余白を作ると、端末によってはリストの最初の項目のクリックがうまく処理できない場合があった。(原因よくわからん)<br>ヘッダ部分にクリックで何かが起きるようなものを配置するとそれはうまく処理できないと思われる。</p><div class="highlight"><pre class="chroma"><code class="language-kt:ViewPager2BindingAdapters.kt" data-lang="kt:ViewPager2BindingAdapters.kt"><span class="cm">/**
</span><span class="cm"> * `ViewPager2`に選択中のメニュー項目を反映させるやつ
</span><span class="cm"> */</span>
<span class="k">object</span> <span class="nc">ViewPager2BindingAdapters</span> <span class="p">{</span>
    <span class="cm">/**
</span><span class="cm">     * 選択中メニュー項目をセットする
</span><span class="cm">     */</span>
    <span class="n">@JvmStatic</span>
    <span class="n">@BindingAdapter</span><span class="p">(</span><span class="s">&#34;currentItem&#34;</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">setCurrentItem</span><span class="p">(</span><span class="n">viewPager</span><span class="p">:</span> <span class="n">ViewPager2</span><span class="p">,</span> <span class="n">menuItem</span><span class="p">:</span> <span class="n">MenuItem</span><span class="p">?)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">menuItem</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">return</span>

        <span class="k">val</span> <span class="py">nextIdx</span> <span class="p">=</span> <span class="n">MenuItem</span><span class="p">.</span><span class="n">values</span><span class="p">().</span><span class="n">indexOf</span><span class="p">(</span><span class="n">menuItem</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">viewPager</span><span class="p">.</span><span class="n">currentItem</span> <span class="p">!=</span> <span class="n">nextIdx</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">viewPager</span><span class="p">.</span><span class="n">currentItem</span> <span class="p">=</span> <span class="n">nextIdx</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="cm">/**
</span><span class="cm">     * 現在表示中のページを選択中メニュー項目に反映する
</span><span class="cm">     */</span>
    <span class="n">@JvmStatic</span>
    <span class="n">@InverseBindingAdapter</span><span class="p">(</span><span class="n">attribute</span> <span class="p">=</span> <span class="s">&#34;currentItem&#34;</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">getCurrentItem</span><span class="p">(</span><span class="n">viewPager</span><span class="p">:</span> <span class="n">ViewPager2</span><span class="p">)</span> <span class="p">:</span> <span class="n">MenuItem</span> <span class="p">=</span>
        <span class="n">MenuItem</span><span class="p">.</span><span class="n">values</span><span class="p">().</span><span class="n">getOrElse</span><span class="p">(</span><span class="n">viewPager</span><span class="p">.</span><span class="n">currentItem</span><span class="p">)</span> <span class="p">{</span> <span class="n">MenuItem</span><span class="p">.</span><span class="n">GENERAL</span> <span class="p">}</span>

    <span class="cm">/**
</span><span class="cm">     * 双方向バインド用の設定
</span><span class="cm">     */</span>
    <span class="n">@JvmStatic</span>
    <span class="n">@BindingAdapter</span><span class="p">(</span><span class="s">&#34;currentItemAttrChanged&#34;</span><span class="p">)</span>
    <span class="k">fun</span> <span class="nf">bindListeners</span><span class="p">(</span><span class="n">viewPager</span><span class="p">:</span> <span class="n">ViewPager2</span><span class="p">,</span> <span class="n">listener</span><span class="p">:</span> <span class="n">InverseBindingListener</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">viewPager</span><span class="p">.</span><span class="n">setPageTransformer</span> <span class="p">{</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="p">-&gt;</span>
            <span class="n">listener</span><span class="p">.</span><span class="n">onChange</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><div class="highlight"><pre class="chroma"><code class="language-kt:MenuItem.kt" data-lang="kt:MenuItem.kt"><span class="cm">/**
</span><span class="cm"> * ページ遷移用メニュー項目
</span><span class="cm"> */</span>
<span class="k">enum</span> <span class="k">class</span> <span class="nc">MenuItem</span><span class="p">(</span>
    <span class="n">@StringRes</span> <span class="k">val</span> <span class="py">labelId</span> <span class="p">:</span> <span class="n">Int</span><span class="p">,</span>
    <span class="n">@DrawableRes</span> <span class="k">val</span> <span class="py">iconId</span> <span class="p">:</span> <span class="n">Int</span><span class="p">,</span>
    <span class="k">val</span> <span class="py">fragment</span> <span class="p">:</span> <span class="p">()-&gt;</span><span class="n">Fragment</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="n">GENERAL</span><span class="p">(</span>
        <span class="n">R</span><span class="p">.</span><span class="n">string</span><span class="p">.</span><span class="n">prefs_menu_label_generals</span><span class="p">,</span>
        <span class="n">R</span><span class="p">.</span><span class="n">drawable</span><span class="p">.</span><span class="n">ic_settings</span><span class="p">,</span>
        <span class="p">{</span> <span class="n">GeneralPrefsFragment</span><span class="p">.</span><span class="n">createInstance</span><span class="p">()</span> <span class="p">}</span>
    <span class="p">),</span>

    <span class="n">APPLICATIONS</span><span class="p">(</span>
        <span class="n">R</span><span class="p">.</span><span class="n">string</span><span class="p">.</span><span class="n">prefs_menu_label_applications</span><span class="p">,</span>
        <span class="n">R</span><span class="p">.</span><span class="n">drawable</span><span class="p">.</span><span class="n">ic_apps</span><span class="p">,</span>
        <span class="p">{</span> <span class="n">InstalledApplicationsFragment</span><span class="p">.</span><span class="n">createInstance</span><span class="p">()</span> <span class="p">}</span>
    <span class="p">),</span>

    <span class="n">WHITE_LIST</span><span class="p">(</span>
        <span class="n">R</span><span class="p">.</span><span class="n">string</span><span class="p">.</span><span class="n">prefs_menu_label_while_list</span><span class="p">,</span>
        <span class="n">R</span><span class="p">.</span><span class="n">drawable</span><span class="p">.</span><span class="n">ic_notifications_active</span><span class="p">,</span>
        <span class="p">{</span> <span class="n">Fragment</span><span class="p">()</span> <span class="p">}</span> <span class="c1">// TODO: まだ作ってる途中
</span><span class="c1"></span>    <span class="p">),</span>

    <span class="n">BLACK_LIST</span><span class="p">(</span>
        <span class="n">R</span><span class="p">.</span><span class="n">string</span><span class="p">.</span><span class="n">prefs_menu_label_black_list</span><span class="p">,</span>
        <span class="n">R</span><span class="p">.</span><span class="n">drawable</span><span class="p">.</span><span class="n">ic_notifications_off</span><span class="p">,</span>
        <span class="p">{</span> <span class="n">Fragment</span><span class="p">()</span> <span class="p">}</span> <span class="c1">// TODO: まだ作ってる途中
</span><span class="c1"></span>    <span class="p">),</span>

    <span class="n">INFORMATION</span><span class="p">(</span>
        <span class="n">R</span><span class="p">.</span><span class="n">string</span><span class="p">.</span><span class="n">prefs_menu_label_information</span><span class="p">,</span>
        <span class="n">R</span><span class="p">.</span><span class="n">drawable</span><span class="p">.</span><span class="n">ic_info</span><span class="p">,</span>
        <span class="p">{</span> <span class="n">InformationFragment</span><span class="p">.</span><span class="n">createInstance</span><span class="p">()</span> <span class="p">}</span>
    <span class="p">),</span>

    <span class="p">;</span>

    <span class="c1">// 動的にメニュー項目を変化させる予定がないなら`ListAdapter&lt;T,VH&gt;`使わないで
</span><span class="c1"></span>    <span class="c1">// `RecyclerView`用のもっと簡単なアダプタを使えばいいのでその場合これも要らない
</span><span class="c1"></span>    <span class="k">class</span> <span class="nc">DiffCallback</span> <span class="p">:</span> <span class="n">DiffUtil</span><span class="p">.</span><span class="n">ItemCallback</span><span class="p">&lt;</span><span class="n">MenuItem</span><span class="p">&gt;()</span> <span class="p">{</span>
        <span class="k">override</span> <span class="k">fun</span> <span class="nf">areItemsTheSame</span><span class="p">(</span><span class="n">oldItem</span><span class="p">:</span> <span class="n">MenuItem</span><span class="p">,</span> <span class="n">newItem</span><span class="p">:</span> <span class="n">MenuItem</span><span class="p">)</span> <span class="p">=</span>
            <span class="n">oldItem</span><span class="p">.</span><span class="n">name</span> <span class="p">==</span> <span class="n">newItem</span><span class="p">.</span><span class="n">name</span>

        <span class="k">override</span> <span class="k">fun</span> <span class="nf">areContentsTheSame</span><span class="p">(</span><span class="n">oldItem</span><span class="p">:</span> <span class="n">MenuItem</span><span class="p">,</span> <span class="n">newItem</span><span class="p">:</span> <span class="n">MenuItem</span><span class="p">)</span> <span class="p">=</span>
            <span class="n">oldItem</span><span class="p">.</span><span class="n">name</span> <span class="p">==</span> <span class="n">newItem</span><span class="p">.</span><span class="n">name</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></article></div></div><div class="Box mt-3 position-relative"><div class="Box-body instapaper_body"><article class="markdown-body entry-content p-3 p-md-6" itemprop="text"><h2>See Also</h2><ul class="mt-2"><li class="p-1"><div><a href="/posts/2020/11_29_00_view_binding/">ViewBindingの使い方と旧手法からの移行</a>
<time datetime="2020-11-29 15:40" class="no-wrap text-small ml-1">(2020-11-29 15:40)</time></div><div class="text-small text-gray mb-1 mt-1">Viewの参照方法が(多分随分前に)新しくなっていた件</div></li><li class="p-1"><div><a href="/posts/2020/12_01_00_show_dialog_from_dialog/">ダイアログからダイアログを開く</a>
<time datetime="2020-12-01 20:45" class="no-wrap text-small ml-1">(2020-12-01 20:45)</time></div><div class="text-small text-gray mb-1 mt-1">画面回転で色々アレするやつの対策</div></li><li class="p-1"><div><a href="/posts/2020/11_26_00_options_menu_background/">オプションメニューの背景色を変更する</a>
<time datetime="2020-11-26 21:43" class="no-wrap text-small ml-1">(2020-11-26 21:43)</time></div><div class="text-small text-gray mb-1 mt-1">アクションバーのオプションメニューの背景色の変え方</div></li><li class="p-1"><div><a href="/posts/2020/10_26_00_webview_image_link_url/">WebViewで画像リンクを長押ししたときにもリンク先URLを取得する方法</a>
<time datetime="2020-10-26 20:14" class="no-wrap text-small ml-1">(2020-10-26 20:14)</time></div><div class="text-small text-gray mb-1 mt-1">hitTestResultを使用するだけだと画像URLしか得られないので、ひと手間必要というお話</div></li><li class="p-1"><div><a href="/posts/2020/10_21_00_satena_150/">Satena version 1.5.x</a>
<time datetime="2020-10-21 23:00" class="no-wrap text-small ml-1">(2020-10-21 23:00)</time></div><div class="text-small text-gray mb-1 mt-1">新機能の紹介</div></li></ul></article></div></div></div></div></main></div></div><script src="https://suihan74.github.io/js/syntax-highlight-title.js" crossorigin="anonymous" type="application/javascript"></script><div class="mt-3 position-relative center"><script type="text/javascript">var nend_params={"media":68318,"site":345989,"spot":1025926,"type":1,"oriented":1};</script><script type="text/javascript" src="https://js1.nend.net/js/nendAdLoader.js"></script></div><div class="utterances"></div><script>var utterancesTheme='github-light'
var utterancesScript=document.createElement('script');utterancesScript.src='https://utteranc.es/client.js';utterancesScript.setAttribute('repo','suihan74\/suihan74.github.io');utterancesScript.setAttribute('issue-term','title');utterancesScript.setAttribute('theme',utterancesTheme);utterancesScript.setAttribute('crossorigin','anonymous');utterancesScript.setAttribute('async','');document.querySelector('.utterances').appendChild(utterancesScript);</script><noscript>Please enable JavaScript to view the comments</noscript><div class="footer container-lg width-full p-responsive" role="contentinfo"><div class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light"><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"><li class="mr-3 mr-lg-0">© 2021 すいはん.</li><li class="mr-3 mr-lg-0">Theme by <a href="https://github.com/MeiK2333/github-style"><span>github-style</span></a> (<a href="https://github.com/suihan74/github-style"><span>customized</span></a>)</li><li class="mr-3 mr-lg-0"><a href="/privacy">Privacy</a></li></ul><a aria-label="Homepage" title="すいはんぶろぐ.io" class="footer-octicon d-none d-lg-block mx-lg-4" href="https://suihan74.github.io/"><svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24"
                aria-hidden="true">
                <path style="fill-rule:evenodd" d="M 8,0 C 3.58,0 0,3.58 0,8 c 0,3.54 2.29,6.53 5.47,7.59 0.4,0.07 0.55,-0.17 0.55,-0.38 0,-0.19 -0.077797,-1.481017 -0.077797,-2.151017 C 5.9433346,12.597005 6.1160655,11.824118 6.56,11.53 4.78,11.33 3.8013559,10.978983 3.5810169,7.6647458 3.9355372,4.6446549 5.3653277,3.8240736 8.0538984,3.639661 10.967753,3.8102868 12.141357,4.4459308 12.425085,7.6477967 12.255593,10.378813 11.25,11.33 9.47,11.53 c 0.29,0.25 0.54,0.73 0.54,1.48 0,1.07 -0.01,1.93 -0.01,2.2 0,0.21 0.15,0.46 0.55,0.38 C 13.806446,14.490656 15.999121,11.437004 16,8 16,3.58 12.42,0 8,0 Z" />
                <rect style="fill-rule:evenodd" ry="0.23728813" y="6.3898306" x="6.0169492" height="1.0847455" width="3.9830508"/>
                
            </svg></a><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"></ul></div><div class="d-flex flex-justify-center pb-6"><span class="f6 text-gray-light"></span></div></div><script crossorigin="anonymous" type="application/javascript" src="https://suihan74.github.io/js/frameworks.js"></script><script crossorigin="anonymous" type="application/javascript" src="https://suihan74.github.io/js/github-bootstrap.js"></script><script src="https://suihan74.github.io/js/stop.js"></script><script src="https://suihan74.github.io/js/contributions.js"></script><script src="https://suihan74.github.io/js/lightbox-plus-jquery.min.js"></script><script>lightbox.option({'disableScrolling':true})</script></body></html>