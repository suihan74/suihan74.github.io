<!doctype html><html lang=ja><head><meta charset=utf-8><link crossorigin=anonymous media=all rel=stylesheet href=https://suihan74.github.io/css/frameworks.css?20201201205504><link crossorigin=anonymous media=all rel=stylesheet href=https://suihan74.github.io/css/github.css?20201201205504><link crossorigin=anonymous media=all rel=stylesheet href=https://suihan74.github.io/css/user.css?20201201205504><link crossorigin=anonymous media=all rel=stylesheet href=https://suihan74.github.io/css/lightbox.css><meta name=viewport content="width=device-width"><meta name=description content="zxingでQRコード生成"><meta name=keywords content="Android,kotlin,QRcode"><link rel=canonical href=https://suihan74.github.io/posts/2020/02_20_00_generate_qrcode/><meta name=twitter:card content="summary"><meta name=twitter:title content="AndroidでQRコードを生成して画面に表示する - すいはんぶろぐ.io"><meta name=twitter:description content="zxingでQRコード生成"><meta name=twitter:site content="https://suihan74.github.io/"><meta name=twitter:creator content><meta name=twitter:image content="https://suihan74.github.io/"><meta property="og:url" content="https://suihan74.github.io/posts/2020/02_20_00_generate_qrcode/"><meta property="og:site_name" content="すいはんぶろぐ.io"><meta property="og:type" content="article"><meta property="og:title" content="AndroidでQRコードを生成して画面に表示する"><meta property="og:description" content="zxingでQRコード生成"><meta property="article:published_time" content="2020-02-20 01:48:21 +0900 JST"><title>AndroidでQRコードを生成して画面に表示する - すいはんぶろぐ.io</title><link rel=icon type=image/x-icon class=js-site-favicon href=https://suihan74.github.io/favicon.ico><link rel="shortcut icon" href=https://suihan74.github.io/favicon.ico><meta name=theme-color content="#1e2327"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-71542625-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-71542625-2');</script></head><body class="env-production emoji-size-boost page-responsive page-profile"><div class="position-relative js-header-wrapper"><span class="Progress progress-pjax-loader position-fixed width-full js-pjax-loader-bar"><span class="progress-pjax-loader-bar top-0 left-0" style=width:0%></span></span><header class="Header py-lg-0 js-details-container Details flex-wrap flex-lg-nowrap p-responsive" role=banner><div class="Header-item d-none d-lg-flex"><a class=Header-link href=https://suihan74.github.io/ aria-label=Homepage data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1" width="32" aria-hidden="true">
                    <path style="fill-rule:evenodd" d="M 8,0 C 3.58,0 0,3.58 0,8 c 0,3.54 2.29,6.53 5.47,7.59 0.4,0.07 0.55,-0.17 0.55,-0.38 0,-0.19 -0.077797,-1.481017 -0.077797,-2.151017 C 5.9433346,12.597005 6.1160655,11.824118 6.56,11.53 4.78,11.33 3.8013559,10.978983 3.5810169,7.6647458 3.9355372,4.6446549 5.3653277,3.8240736 8.0538984,3.639661 10.967753,3.8102868 12.141357,4.4459308 12.425085,7.6477967 12.255593,10.378813 11.25,11.33 9.47,11.53 c 0.29,0.25 0.54,0.73 0.54,1.48 0,1.07 -0.01,1.93 -0.01,2.2 0,0.21 0.15,0.46 0.55,0.38 C 13.806446,14.490656 15.999121,11.437004 16,8 16,3.58 12.42,0 8,0 Z" />
                    <rect style="fill-rule:evenodd" ry="0.23728813" y="6.3898306" x="6.0169492" height="1.0847455" width="3.9830508"/>
                </svg><span class=site-title-text>すいはんぶろぐ.io</span></a></div><div class="Header-item Header-item--full flex-column flex-lg-row width-full flex-order-2 flex-lg-order-none mr-0 mr-lg-3 mt-3 mt-lg-0 Details-content--hidden"><div class="header-search flex-self-stretch flex-lg-self-auto mr-0 mr-lg-3 mb-3 mb-lg-0 scoped-search site-scoped-search js-site-search position-relative js-jump-to" role=combobox aria-owns=jump-to-results aria-label="Search or jump to" aria-haspopup=listbox aria-expanded=false><div class=position-relative></div></div></div><nav class=d-flex aria-label=Global><a class="js-selected-navigation-item Header-link py-lg-3">&nbsp;</a></nav><div class="Header-item Header-item--full flex-justify-center d-lg-none position-relative" style=margin-right:auto><a class=Header-link href=https://suihan74.github.io/ aria-label=Homepage data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1"
                    width="32" aria-hidden="true">
                    <path style="fill-rule:evenodd" d="M 8,0 C 3.58,0 0,3.58 0,8 c 0,3.54 2.29,6.53 5.47,7.59 0.4,0.07 0.55,-0.17 0.55,-0.38 0,-0.19 -0.077797,-1.481017 -0.077797,-2.151017 C 5.9433346,12.597005 6.1160655,11.824118 6.56,11.53 4.78,11.33 3.8013559,10.978983 3.5810169,7.6647458 3.9355372,4.6446549 5.3653277,3.8240736 8.0538984,3.639661 10.967753,3.8102868 12.141357,4.4459308 12.425085,7.6477967 12.255593,10.378813 11.25,11.33 9.47,11.53 c 0.29,0.25 0.54,0.73 0.54,1.48 0,1.07 -0.01,1.93 -0.01,2.2 0,0.21 0.15,0.46 0.55,0.38 C 13.806446,14.490656 15.999121,11.437004 16,8 16,3.58 12.42,0 8,0 Z" />
                    <rect style="fill-rule:evenodd" ry="0.23728813" y="6.3898306" x="6.0169492" height="1.0847455" width="3.9830508"/>
                </svg><span class=site-title-text>すいはんぶろぐ.io</span></a></div><div class="Header-item position-relative mr-0 d-none d-lg-flex Details-content--hidden"><div class="header-search flex-self-stretch flex-lg-self-auto mr-0 mr-lg-3 mb-3 mb-lg-0 position-relative js-jump-to"><div class=position-relative><form class=js-site-search-form role=search action=https://cse.google.com/cse method=get><input type=hidden name=cx value=006598476776954487838:x6qvcxfxgqt>
<label class="form-control input-sm header-search-wrapper p-0 header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center js-chromeless-input-container"><input type=text class="header-search-form form-control input-sm header-search-input jump-to-field js-jump-to-field" name=q placeholder=Search autocapitalize=off aria-label=Search spellcheck=false onkeydown="if(event.keyCode==13){if(this.value.length){document.getElementById('header-search-submit').click();return false}else{return false}};" autocomplete=off>
<button id=header-search-submit class="mr-1 ml-1 header-search-button" type=submit><svg class="header-search-button-icon" width="13" height="13" viewBox="0 0 13 13">
                                    <title>サイト内検索</title>
                                    <path d="m4.8495 7.8226c0.82666 0 1.5262-0.29146 2.0985-0.87438 0.57232-0.58292 0.86378-1.2877 0.87438-2.1144 0.010599-0.82666-0.28086-1.5262-0.87438-2.0985-0.59352-0.57232-1.293-0.86378-2.0985-0.87438-0.8055-0.010599-1.5103 0.28086-2.1144 0.87438-0.60414 0.59352-0.8956 1.293-0.87438 2.0985 0.021197 0.8055 0.31266 1.5103 0.87438 2.1144 0.56172 0.60414 1.2665 0.8956 2.1144 0.87438zm4.4695 0.2115 3.681 3.6819-1.259 1.284-3.6817-3.7 0.0019784-0.69479-0.090043-0.098846c-0.87973 0.76087-1.92 1.1413-3.1207 1.1413-1.3553 0-2.5025-0.46363-3.4417-1.3909s-1.4088-2.0686-1.4088-3.4239c0-1.3553 0.4696-2.4966 1.4088-3.4239 0.9392-0.92727 2.0864-1.3969 3.4417-1.4088 1.3553-0.011889 2.4906 0.45771 3.406 1.4088 0.9154 0.95107 1.379 2.0924 1.3909 3.4239 0 1.2126-0.38043 2.2588-1.1413 3.1385l0.098834 0.090049z"></path>
                                </svg></button></label></form></div></div></div></header></div><div id=start-of-content class=show-on-focus></div><div id=js-flash-container></div><div class=application-main data-commit-hovercards-enabled><div itemscope itemtype=http://schema.org/SoftwareSourceCode><main id=js-repo-pjax-container data-pjax-container><div class="pagehead repohead instapaper_ignore readability-menu experiment-repo-nav pt-lg-4"><div class="repohead-details-container clearfix container-lg p-responsive d-lg-block"><div class=d-flex><h1 class="public css-truncate float-none flex-auto width-fit pl-0"><a class="avatar mr-1" href=https://suihan74.github.io/about/><img src=/images/author.png class=avatar-user width=26 height=26 title=すいはん></a>
<strong itemprop=name><a href=https://suihan74.github.io/posts/2020/02_20_00_generate_qrcode/>AndroidでQRコードを生成して画面に表示する</a></strong><div class="text-small text-gray mb-1 mt-1">zxingでQRコード生成</div><div class="text-small text-gray"><svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
  <path fill-rule="evenodd" d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z"></path>
</svg><a href=/tags/android/>Android</a> <a href=/tags/kotlin/>kotlin</a> <a href=/tags/qrcode/>QRcode</a></div><div class="d-block text-small text-gray">Created at <time datetime="2020-02-20 01:48" class=no-wrap>2020/02/20 01:48</time>
<span class=file-info-divider></span>Updated at <time datetime="2020-09-02 03:00" class=no-wrap>2020/09/02 03:00</time></div></h1></div></div></div><div class="container-lg clearfix new-discussion-timeline experiment-repo-nav p-responsive"><div class=repository-content><div class="Box mt-3 position-relative"><div class="Box-header py-2 d-flex flex-column flex-shrink-0 flex-md-row flex-md-items-center"><div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">1978 Words</div><div class="d-flex py-1 py-md-0 flex-auto flex-order-1 flex-md-order-2 flex-sm-grow-0 flex-justify-between"><div class=BtnGroup><a rel=nofollow class="btn btn-sm BtnGroup-item" href=https://github.com/suihan74/hugo_files/commits/master/content/posts/2020/02_20_00_generate_qrcode.md>History</a></div></div></div><div id=readme class="Box-body readme blob instapaper_body js-code-block-container"><article class="markdown-body entry-content p-3 p-md-6" itemprop=text><p>AndroidアプリでQRコードを生成して画面に表示する方法。今回は読み取りについては書いていない。</p><h2 id=追記-2020-09-02>追記 (2020-09-02)<a class=anchor aria-hidden=true href=#追記-2020-09-02><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><p>あまりにあんまりだったのでサンプルコードを修正した。<br>まぁ多少はマシになった。</p><h2 id=追記-2020-07-21>追記 (2020-07-21)<a class=anchor aria-hidden=true href=#追記-2020-07-21><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><p>データバインディングの始め方についての記事へのリンクを追加。</p><h2 id=追記-2020-03-31>追記 (2020-03-31)<a class=anchor aria-hidden=true href=#追記-2020-03-31><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><p>lifecycleに関する依存先のバージョンを<code>2.2.0</code>にアップデート。<br>それに伴い、<code>ViewModelProvider</code>を使用したViewModelのインスタンス生成方法を修正。</p><p><code>ViewModelProviders.of(owner)</code> → <code>ViewModelProvider(owner)</code>]</p><hr><h2 id=準備>準備<a class=anchor aria-hidden=true href=#準備><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><p>ここでは(無駄に)データバインディングを使用しているので、準備が必要ならしておく。</p><p><a href=/posts/2020/01_02_00_beginning_of_data_binding/#buildgradle-app>Android - DataBindingはじめ - すいはんぶろぐ.io</a></p><h2 id=buildgradle-app>build.gradle (app)<a class=anchor aria-hidden=true href=#buildgradle-app><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><p><a href=https://github.com/journeyapps/zxing-android-embedded target=_blank>journeyapps/zxing-android-embedded</a>
というライブラリを使うことにした。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gradle data-lang=gradle>dependencies <span style=color:#f92672>{</span>
<span style=color:#f92672>...</span>
    <span style=color:#75715e>// QR code
</span><span style=color:#75715e></span>    implementation <span style=color:#e6db74>&#39;com.journeyapps:zxing-android-embedded:4.1.0&#39;</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>READMEに色々書いてあるが、QRコードの読み込みはしないで単純にQRコードを生成するだけならそんなに色々やる必要はなさそう。</p><h2 id=model>Model<a class=anchor aria-hidden=true href=#model><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kt data-lang=kt><span style=color:#66d9ef>package</span> com.suihan74.sample

<span style=color:#66d9ef>import</span> android.graphics.Color
<span style=color:#66d9ef>import</span> com.google.zxing.qrcode.decoder.ErrorCorrectionLevel

<span style=color:#75715e>/** QRコード生成の元情報 */</span>
<span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>QRSource</span>(
    <span style=color:#75715e>/** QR化するデータ */</span>
    <span style=color:#66d9ef>val</span> data: String,

    <span style=color:#75715e>/**
</span><span style=color:#75715e>     * QRコードサイズ(px)
</span><span style=color:#75715e>     *
</span><span style=color:#75715e>     * dpではなくpxなので注意
</span><span style=color:#75715e>     */</span>
    <span style=color:#66d9ef>val</span> size: Int,

    <span style=color:#75715e>/** 誤り訂正レベル */</span>
    <span style=color:#66d9ef>val</span> errorCorrectionLevel: ErrorCorrectionLevel,

    <span style=color:#75715e>/** 文字コード */</span>
    <span style=color:#66d9ef>val</span> charset: String,

    <span style=color:#75715e>/**
</span><span style=color:#75715e>     * マージン(セル数, 4セル以上の余白が必要)
</span><span style=color:#75715e>     *
</span><span style=color:#75715e>     * レイアウト側で確実に4セル分以上の余白を用意してある場合には0にした方が制御しやすいかもしれない
</span><span style=color:#75715e>     */</span>
    <span style=color:#66d9ef>val</span> margin: Int = <span style=color:#ae81ff>4</span>,

    <span style=color:#75715e>/** 前景色 */</span>
    <span style=color:#66d9ef>val</span> foregroundColor: Int = Color.BLACK,

    <span style=color:#75715e>/** 背景色 */</span>
    <span style=color:#66d9ef>val</span> backgroundColor: Int = Color.WHITE
)
</code></pre></div><h2 id=viewmodel>ViewModel<a class=anchor aria-hidden=true href=#viewmodel><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kt data-lang=kt><span style=color:#66d9ef>package</span> com.suihan74.sample

<span style=color:#66d9ef>import</span> android.graphics.Bitmap
<span style=color:#66d9ef>import</span> android.graphics.Color
<span style=color:#66d9ef>import</span> android.util.Log
<span style=color:#66d9ef>import</span> androidx.lifecycle.LiveData
<span style=color:#66d9ef>import</span> androidx.lifecycle.MutableLiveData
<span style=color:#66d9ef>import</span> androidx.lifecycle.ViewModel
<span style=color:#66d9ef>import</span> androidx.lifecycle.viewModelScope
<span style=color:#66d9ef>import</span> com.google.zxing.BarcodeFormat
<span style=color:#66d9ef>import</span> com.google.zxing.EncodeHintType
<span style=color:#66d9ef>import</span> com.google.zxing.qrcode.decoder.ErrorCorrectionLevel
<span style=color:#66d9ef>import</span> com.journeyapps.barcodescanner.BarcodeEncoder
<span style=color:#66d9ef>import</span> kotlinx.coroutines.Dispatchers
<span style=color:#66d9ef>import</span> kotlinx.coroutines.launch

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HogeViewModel</span> : ViewModel() {
    <span style=color:#75715e>/** QRコード化する情報 */</span>
    <span style=color:#66d9ef>var</span> qrSource: QRSource? = <span style=color:#66d9ef>null</span>
        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>set</span>

    <span style=color:#75715e>/** QRコードのビットマップ */</span>
    <span style=color:#66d9ef>val</span> qrBitmap: LiveData&lt;Bitmap?&gt; <span style=color:#66d9ef>by</span> lazy {
        MutableLiveData&lt;Bitmap?&gt;(<span style=color:#66d9ef>null</span>)
    }

    <span style=color:#75715e>/** QRコード化する情報をセット */</span>
    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>setQRSource</span>(qrSource: QRSource?) {
        <span style=color:#66d9ef>this</span>.qrSource = qrSource
        viewModelScope.launch(Dispatchers.Default) {
            (qrBitmap <span style=color:#66d9ef>as</span> MutableLiveData&lt;Bitmap?&gt;).postValue(
                generateQRCodeBitmap(qrSource)
            )
        }
    }

    <span style=color:#75715e>/** QRコードのビットマップを生成 */</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>generateQRCodeBitmap</span>(qrSource: QRSource?) : Bitmap? =
        <span style=color:#66d9ef>if</span> (qrSource == <span style=color:#66d9ef>null</span>) <span style=color:#66d9ef>null</span>
        <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>try</span> {
            <span style=color:#75715e>// 生成に関するパラメータ
</span><span style=color:#75715e></span>            <span style=color:#66d9ef>val</span> hints = mapOf(
                <span style=color:#75715e>// マージン
</span><span style=color:#75715e></span>                EncodeHintType.MARGIN to qrSource.margin,
                <span style=color:#75715e>// 誤り訂正レベル
</span><span style=color:#75715e></span>                EncodeHintType.ERROR_CORRECTION to qrSource.errorCorrectionLevel,
                <span style=color:#75715e>// 文字コード
</span><span style=color:#75715e></span>                EncodeHintType.CHARACTER_SET to qrSource.charset
            )

            BarcodeEncoder().encodeBitmap(
                qrSource.<span style=color:#66d9ef>data</span>,
                BarcodeFormat.QR_CODE,
                pxSize, pxSize,
                hints
            ).also { encoder -&gt;
                <span style=color:#75715e>// 黒白以外にしたいならここで適当にQRコードを色付けする
</span><span style=color:#75715e></span>                <span style=color:#66d9ef>val</span> pixels = IntArray(pxSize * pxSize)
                encoder.getPixels(pixels, <span style=color:#ae81ff>0</span>, pxSize, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, pxSize, pxSize)
                <span style=color:#66d9ef>for</span> (idx <span style=color:#66d9ef>in</span> pixels.indices) {
                    pixels[idx] =
                        <span style=color:#66d9ef>if</span> (pixels[idx] == Color.BLACK) qrSource.foregroundColor
                        <span style=color:#66d9ef>else</span> qrSource.backgroundColor
                }
                encoder.setPixels(pixels, <span style=color:#ae81ff>0</span>, pxSize, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, pxSize, pxSize)
            }
        }
        <span style=color:#66d9ef>catch</span> (e: Throwable) {
            Log.e(<span style=color:#e6db74>&#34;genQRCode&#34;</span>, Log.getStackTraceString(e))
            <span style=color:#66d9ef>null</span>
        }
}
</code></pre></div><h2 id=activity>Activity<a class=anchor aria-hidden=true href=#activity><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kt data-lang=kt><span style=color:#66d9ef>package</span> com.suihan74.sample

<span style=color:#66d9ef>import</span> androidx.appcompat.app.AppCompatActivity
<span style=color:#66d9ef>import</span> androidx.databinding.DataBindingUtil
<span style=color:#66d9ef>import</span> androidx.lifecycle.ViewModelProviders
<span style=color:#66d9ef>import</span> com.suihan74.sample.R
<span style=color:#66d9ef>import</span> com.suihan74.sample.databinding.ActivityHogeBinding
<span style=color:#66d9ef>import</span> kotlinx.android.synthetic.main.activity_hoge.*

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HogeActivity</span> : AppCompatActivity {
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> viewModel: HogeViewModel <span style=color:#66d9ef>by</span> lazy {
        ViewModelProvider(<span style=color:#66d9ef>this</span>)[HogeViewModel<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java]
    }

    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onCreate</span>(savedInstanceState: Bundle?) {
        <span style=color:#66d9ef>super</span>.onCreate(savedInstanceState)

        DataBindingUtil.setContentView&lt;ActivityHogeBinding&gt;(
            <span style=color:#66d9ef>this</span>,
            R.layout.activity_hoge
        ).apply {
            lifecycleOwner = <span style=color:#66d9ef>this</span>@HogeActivity
            vm = viewModel
        }

        <span style=color:#75715e>// サンプルだし適当にこの辺で値入れちゃう
</span><span style=color:#75715e></span>        viewModel.setQRSource(
            QRSource(
                <span style=color:#66d9ef>data</span> = <span style=color:#e6db74>&#34;https://suihan742.github.io&#34;</span>,
                size = resources.getDimensionPixelSize(R.dimen.qr_size),
                errorCorrectionLevel = ErrorCorrectionLevel.M,
                charset = <span style=color:#e6db74>&#34;UTF-8&#34;</span>,
                margin = <span style=color:#ae81ff>0</span>,
            ),
            <span style=color:#66d9ef>this</span>
        )
    }
}
</code></pre></div><h2 id=bindingadapter>BindingAdapter<a class=anchor aria-hidden=true href=#bindingadapter><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kt data-lang=kt><span style=color:#66d9ef>package</span> com.suihan74.sample

<span style=color:#66d9ef>import</span> android.graphics.Bitmap
<span style=color:#66d9ef>import</span> android.widget.ImageView
<span style=color:#66d9ef>import</span> androidx.databinding.BindingAdapter

<span style=color:#75715e>/** ImageViewにBitmapをバインドする */</span>
@BindingAdapter(<span style=color:#e6db74>&#34;bitmap&#34;</span>)
<span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>ImageView</span>.setBitmapSource(bitmap: Bitmap?) {
    <span style=color:#66d9ef>this</span>.setImageBitmap(bitmap)
}
</code></pre></div><h2 id=layout>Layout<a class=anchor aria-hidden=true href=#layout><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
<span style=color:#f92672>&lt;layout</span> <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span><span style=color:#f92672>&gt;</span>
    <span style=color:#f92672>&lt;data&gt;</span>
        <span style=color:#f92672>&lt;variable</span>
            <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;vm&#34;</span>
            <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;com.suihan74.sample.HogeViewModel&#34;</span> <span style=color:#f92672>/&gt;</span>
    <span style=color:#f92672>&lt;/data&gt;</span>

    <span style=color:#f92672>&lt;LinearLayout</span>
        <span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;vertical&#34;</span>
        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;match_parent&#34;</span><span style=color:#f92672>&gt;</span>

        <span style=color:#f92672>&lt;ImageView</span>
            <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/QRImageView&#34;</span>
            <span style=color:#a6e22e>bitmap=</span><span style=color:#e6db74>&#34;@{vm.qrBitmap}&#34;</span>
            <span style=color:#a6e22e>android:contentDescription=</span><span style=color:#e6db74>&#34;@null&#34;</span>
            <span style=color:#a6e22e>android:scaleType=</span><span style=color:#e6db74>&#34;center&#34;</span>
            <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;@dimen/qr_size&#34;</span>
            <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;@dimen/qr_size&#34;</span> <span style=color:#f92672>/&gt;</span>

...

    <span style=color:#f92672>&lt;/LinearLayout&gt;</span>
<span style=color:#f92672>&lt;/layout&gt;</span>
</code></pre></div><p><code>Bitmap</code>の生成はコルーチンで行い、生成完了したらpostValue()で渡す。</p><h3 id=encodehinttype>EncodeHintType<a class=anchor aria-hidden=true href=#encodehinttype><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><p><code>barcodeEncoder.encodeBitmap()</code>に<code>hints</code>を渡すことで色々指定できる。</p><p>指定できる項目は以下。QRコード以外の二次元コードに関する設定値についての説明は適当(というかよく知らないのでコメント直訳)</p><ul><li><p><code>ERROR_CORRECTION</code> …… 誤り訂正レベルの指定。</p><ul><li>QRコードのエンコーディングでは<code>ErrorCorrectionLevel.L,M,Q,H</code>のどれかを指定できる。<br>訂正率をより高くすれば汚れや破損に強くなるが、誤り訂正に必要な情報量が増える。バージョンを指定する場合、エンコード対象のデータ量と誤り訂正に必要なデータ量を考慮する必要がある。</li></ul><table><thead><tr><th align=center>ErrorCorrectionLevel</th><th align=center>誤り訂正率(%)</th></tr></thead><tbody><tr><td align=center>L</td><td align=center>7</td></tr><tr><td align=center>M</td><td align=center>15</td></tr><tr><td align=center>Q</td><td align=center>25</td></tr><tr><td align=center>H</td><td align=center>30</td></tr></tbody></table><ul><li><p>Aztecコードの場合は1~99のパーセンテージを整数値で与えるらしい</p></li><li><p>PDF417コードの場合は0~8の整数値を与えるらしい</p></li></ul></li><li><p><code>CHARACTER_SET</code> …… dataの文字コード (デフォルト: &ldquo;ISO-8859-1&rdquo;)<br>URLをエンコードしたい場合はデフォルトでとくに問題にならないように思えるが、日本語文字列などをエンコードしたい場合は指定する必要がある。</p></li><li><p><code>MARGIN</code> …… マージンサイズの指定 (デフォルト: 4)<br>QRコードは周囲4セル以上のマージンが必要らしいが、レイアウト側で別途マージンを指定している場合には0にしておいた方が扱いやすいように思える。</p></li><li><p><code>QR_VERSION</code> …… QRコードのバージョン (デフォルト: データサイズと訂正率に応じて変化？)<br>1~40で指定できる。バージョンごとにセル数が決まっており、バージョンが大きいほどよりセル数が多くなる(表現できる情報量が増える)<br>参考: <a href=https://www.qrcode.com/about/version.html>https://www.qrcode.com/about/version.html</a></p></li><li><p><code>DATA_MATRIX_SHAPE</code> …… 正方形か長方形かということを指定するらしい<br>通常のQRコードの場合とくに指定しないか<code>FORCE_SQUARE</code>でいい</p><ul><li><code>SynbolShapeHint.FORCE_NONE</code> …… 指定なし</li><li><code>SynbolShapeHint.FORCE_SQUARE</code> …… 正方形</li><li><code>SynbolShapeHint.FORCE_RECTANGLE</code> …… 長方形</li></ul></li></ul><p>以下QRコード<strong>以外</strong>に対するもの</p><ul><li><p><code>PDF417_COMPACT</code> …… PDF417コードでコンパクトモードを使用するか (true or false)</p></li><li><p><code>PDF417_COMPACTION</code> …… PDF417コードでのコンパクト化する際のモード</p></li><li><p><code>PDF417_DIMENSIONS</code> …… 行数・列数の最大最小値(Dimensions型)</p></li><li><p><code>AZTEC_LAYERS</code> …… Aztecコードのレイヤー数</p><ul><li>(-1,-2,-3,-4) …… コンパクトAztecコード</li><li>0 …… 最小レイヤー数になるようにする (デフォルト)</li><li>(1,2,&mldr;,32) …… 通常の(非コンパクトな)Aztecコード</li></ul></li><li><p><code>GS1_FORMAT</code> …… GS1標準のデータエンコードを強制するか (true or false)<br>GS1QRコードについてはこの辺？ <a href=https://www.dsri.jp/standard/2d-symbol/gs1-qr.html>https://www.dsri.jp/standard/2d-symbol/gs1-qr.html</a></p></li></ul></article></div></div></div></div></main></div></div><div class=utterances></div><script>var utterancesTheme='github-light'
var utterancesScript=document.createElement('script');utterancesScript.src='https://utteranc.es/client.js';utterancesScript.setAttribute('repo','suihan74\/suihan74.github.io');utterancesScript.setAttribute('issue-term','title');utterancesScript.setAttribute('theme',utterancesTheme);utterancesScript.setAttribute('crossorigin','anonymous');utterancesScript.setAttribute('async','');document.querySelector('.utterances').appendChild(utterancesScript);</script><noscript>Please enable JavaScript to view the comments</noscript><div class="footer container-lg width-full p-responsive" role=contentinfo><div class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light"><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"><li class="mr-3 mr-lg-0">© 2020 すいはん. Theme by <a href=https://github.com/MeiK2333/github-style><span>github-style</span></a> (<a href=https://github.com/suihan74/github-style><span>customized</span></a>)</li></ul><a aria-label=Homepage title=すいはんぶろぐ.io class="footer-octicon d-none d-lg-block mx-lg-4" href=https://suihan74.github.io/><svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24"
                aria-hidden="true">
                <path style="fill-rule:evenodd" d="M 8,0 C 3.58,0 0,3.58 0,8 c 0,3.54 2.29,6.53 5.47,7.59 0.4,0.07 0.55,-0.17 0.55,-0.38 0,-0.19 -0.077797,-1.481017 -0.077797,-2.151017 C 5.9433346,12.597005 6.1160655,11.824118 6.56,11.53 4.78,11.33 3.8013559,10.978983 3.5810169,7.6647458 3.9355372,4.6446549 5.3653277,3.8240736 8.0538984,3.639661 10.967753,3.8102868 12.141357,4.4459308 12.425085,7.6477967 12.255593,10.378813 11.25,11.33 9.47,11.53 c 0.29,0.25 0.54,0.73 0.54,1.48 0,1.07 -0.01,1.93 -0.01,2.2 0,0.21 0.15,0.46 0.55,0.38 C 13.806446,14.490656 15.999121,11.437004 16,8 16,3.58 12.42,0 8,0 Z" />
                <rect style="fill-rule:evenodd" ry="0.23728813" y="6.3898306" x="6.0169492" height="1.0847455" width="3.9830508"/>
                
            </svg></a><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"></ul></div><div class="d-flex flex-justify-center pb-6"><span class="f6 text-gray-light"></span></div></div><script crossorigin=anonymous type=application/javascript src=https://suihan74.github.io/js/frameworks.js></script><script crossorigin=anonymous type=application/javascript src=https://suihan74.github.io/js/github-bootstrap.js></script><script src=https://suihan74.github.io/js/stop.js></script><script src=https://suihan74.github.io/js/contributions.js></script><script src=https://suihan74.github.io/js/lightbox-plus-jquery.min.js></script><script>lightbox.option({'disableScrolling':true})</script></body></html>