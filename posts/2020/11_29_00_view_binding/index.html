<!doctype html><html lang=ja><head><meta charset=utf-8><link crossorigin=anonymous media=all rel=stylesheet href=https://suihan74.github.io/css/frameworks.css?20210109152427><link crossorigin=anonymous media=all rel=stylesheet href=https://suihan74.github.io/css/github.css?20210109152427><link crossorigin=anonymous media=all rel=stylesheet href=https://suihan74.github.io/css/user.css?20210109152427><link crossorigin=anonymous media=all rel=stylesheet href=https://suihan74.github.io/css/lightbox.css><link crossorigin=anonymous media=all rel=stylesheet href=https://suihan74.github.io/css/syntax-highlight.css><meta name=viewport content="width=device-width"><meta name=description content="Viewの参照方法が(多分随分前に)新しくなっていた件"><meta name=keywords content="Android,Kotlin,ViewBinding,Kotlin Android Extensions,synthetics"><link rel=canonical href=https://suihan74.github.io/posts/2020/11_29_00_view_binding/><meta name=twitter:card content="summary"><meta name=twitter:title content="ViewBindingの使い方と旧手法からの移行 - すいはんぶろぐ.io"><meta name=twitter:description content="Viewの参照方法が(多分随分前に)新しくなっていた件"><meta name=twitter:site content="https://suihan74.github.io/"><meta name=twitter:creator content><meta name=twitter:image content="https://suihan74.github.io/"><meta property="og:url" content="https://suihan74.github.io/posts/2020/11_29_00_view_binding/"><meta property="og:site_name" content="すいはんぶろぐ.io"><meta property="og:type" content="article"><meta property="og:title" content="ViewBindingの使い方と旧手法からの移行"><meta property="og:description" content="Viewの参照方法が(多分随分前に)新しくなっていた件"><meta property="article:published_time" content="2020-11-29 15:40:00 +0900 JST"><title>ViewBindingの使い方と旧手法からの移行 - すいはんぶろぐ.io</title><link rel=icon type=image/x-icon class=js-site-favicon href=https://suihan74.github.io/favicon.ico><link rel="shortcut icon" href=https://suihan74.github.io/favicon.ico><meta name=theme-color content="#1e2327"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-71542625-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-71542625-2');</script></head><body class="env-production emoji-size-boost page-responsive page-profile"><div class="position-relative js-header-wrapper"><span class="Progress progress-pjax-loader position-fixed width-full js-pjax-loader-bar"><span class="progress-pjax-loader-bar top-0 left-0" style=width:0%></span></span><header class="Header py-lg-0 js-details-container Details flex-wrap flex-lg-nowrap p-responsive" role=banner><div class="Header-item d-none d-lg-flex"><a class=Header-link href=https://suihan74.github.io/ aria-label=Homepage data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1" width="32" aria-hidden="true">
                    <path style="fill-rule:evenodd" d="M 8,0 C 3.58,0 0,3.58 0,8 c 0,3.54 2.29,6.53 5.47,7.59 0.4,0.07 0.55,-0.17 0.55,-0.38 0,-0.19 -0.077797,-1.481017 -0.077797,-2.151017 C 5.9433346,12.597005 6.1160655,11.824118 6.56,11.53 4.78,11.33 3.8013559,10.978983 3.5810169,7.6647458 3.9355372,4.6446549 5.3653277,3.8240736 8.0538984,3.639661 10.967753,3.8102868 12.141357,4.4459308 12.425085,7.6477967 12.255593,10.378813 11.25,11.33 9.47,11.53 c 0.29,0.25 0.54,0.73 0.54,1.48 0,1.07 -0.01,1.93 -0.01,2.2 0,0.21 0.15,0.46 0.55,0.38 C 13.806446,14.490656 15.999121,11.437004 16,8 16,3.58 12.42,0 8,0 Z" />
                    <rect style="fill-rule:evenodd" ry="0.23728813" y="6.3898306" x="6.0169492" height="1.0847455" width="3.9830508"/>
                </svg><span class=site-title-text>すいはんぶろぐ.io</span></a></div><div class="Header-item Header-item--full flex-column flex-lg-row width-full flex-order-2 flex-lg-order-none mr-0 mr-lg-3 mt-3 mt-lg-0 Details-content--hidden"><div class="header-search flex-self-stretch flex-lg-self-auto mr-0 mr-lg-3 mb-3 mb-lg-0 scoped-search site-scoped-search js-site-search position-relative js-jump-to" role=combobox aria-owns=jump-to-results aria-label="Search or jump to" aria-haspopup=listbox aria-expanded=false><div class=position-relative></div></div></div><nav class=d-flex aria-label=Global><a class="js-selected-navigation-item Header-link py-lg-3">&nbsp;</a></nav><div class="Header-item Header-item--full flex-justify-center d-lg-none position-relative" style=margin-right:auto><a class=Header-link href=https://suihan74.github.io/ aria-label=Homepage data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1"
                    width="32" aria-hidden="true">
                    <path style="fill-rule:evenodd" d="M 8,0 C 3.58,0 0,3.58 0,8 c 0,3.54 2.29,6.53 5.47,7.59 0.4,0.07 0.55,-0.17 0.55,-0.38 0,-0.19 -0.077797,-1.481017 -0.077797,-2.151017 C 5.9433346,12.597005 6.1160655,11.824118 6.56,11.53 4.78,11.33 3.8013559,10.978983 3.5810169,7.6647458 3.9355372,4.6446549 5.3653277,3.8240736 8.0538984,3.639661 10.967753,3.8102868 12.141357,4.4459308 12.425085,7.6477967 12.255593,10.378813 11.25,11.33 9.47,11.53 c 0.29,0.25 0.54,0.73 0.54,1.48 0,1.07 -0.01,1.93 -0.01,2.2 0,0.21 0.15,0.46 0.55,0.38 C 13.806446,14.490656 15.999121,11.437004 16,8 16,3.58 12.42,0 8,0 Z" />
                    <rect style="fill-rule:evenodd" ry="0.23728813" y="6.3898306" x="6.0169492" height="1.0847455" width="3.9830508"/>
                </svg><span class=site-title-text>すいはんぶろぐ.io</span></a></div><div class="Header-item position-relative mr-0 d-none d-lg-flex Details-content--hidden"><div class="header-search flex-self-stretch flex-lg-self-auto mr-0 mr-lg-3 mb-3 mb-lg-0 position-relative js-jump-to"><div class=position-relative><form class=js-site-search-form role=search action=https://cse.google.com/cse method=get><input type=hidden name=cx value=006598476776954487838:x6qvcxfxgqt>
<label class="form-control input-sm header-search-wrapper p-0 header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center js-chromeless-input-container"><input type=text class="header-search-form form-control input-sm header-search-input jump-to-field js-jump-to-field" name=q placeholder=Search autocapitalize=off aria-label=Search spellcheck=false onkeydown="if(event.keyCode==13){if(this.value.length){document.getElementById('header-search-submit').click();return false}else{return false}};" autocomplete=off>
<button id=header-search-submit class="mr-1 ml-1 header-search-button" type=submit><svg class="header-search-button-icon" width="13" height="13" viewBox="0 0 13 13">
                                    <title>サイト内検索</title>
                                    <path d="m4.8495 7.8226c0.82666 0 1.5262-0.29146 2.0985-0.87438 0.57232-0.58292 0.86378-1.2877 0.87438-2.1144 0.010599-0.82666-0.28086-1.5262-0.87438-2.0985-0.59352-0.57232-1.293-0.86378-2.0985-0.87438-0.8055-0.010599-1.5103 0.28086-2.1144 0.87438-0.60414 0.59352-0.8956 1.293-0.87438 2.0985 0.021197 0.8055 0.31266 1.5103 0.87438 2.1144 0.56172 0.60414 1.2665 0.8956 2.1144 0.87438zm4.4695 0.2115 3.681 3.6819-1.259 1.284-3.6817-3.7 0.0019784-0.69479-0.090043-0.098846c-0.87973 0.76087-1.92 1.1413-3.1207 1.1413-1.3553 0-2.5025-0.46363-3.4417-1.3909s-1.4088-2.0686-1.4088-3.4239c0-1.3553 0.4696-2.4966 1.4088-3.4239 0.9392-0.92727 2.0864-1.3969 3.4417-1.4088 1.3553-0.011889 2.4906 0.45771 3.406 1.4088 0.9154 0.95107 1.379 2.0924 1.3909 3.4239 0 1.2126-0.38043 2.2588-1.1413 3.1385l0.098834 0.090049z"></path>
                                </svg></button></label></form></div></div></div></header></div><div id=start-of-content class=show-on-focus></div><div id=js-flash-container></div><div class=application-main data-commit-hovercards-enabled><div itemscope itemtype=http://schema.org/SoftwareSourceCode><main id=js-repo-pjax-container data-pjax-container><div class="pagehead repohead instapaper_ignore readability-menu experiment-repo-nav pt-lg-4"><div class="repohead-details-container clearfix container-lg p-responsive d-lg-block"><div class=d-flex><h1 class="public css-truncate float-none flex-auto width-fit pl-0"><a class="avatar mr-1" href=https://suihan74.github.io/about/><img src=/images/author.png class=avatar-user width=26 height=26 title=すいはん></a>
<strong itemprop=name><a href=https://suihan74.github.io/posts/2020/11_29_00_view_binding/>ViewBindingの使い方と旧手法からの移行</a></strong><div class="text-small text-gray mb-1 mt-1">Viewの参照方法が(多分随分前に)新しくなっていた件</div><div class="text-small text-gray"><div class="f6 text-gray mt-1"><a class="muted-link mr-3 d-inline-block" href=/tags/android><svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
  <path fill-rule="evenodd" d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z"></path>
</svg>Android</a>
<a class="muted-link mr-3 d-inline-block" href=/tags/kotlin><svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
  <path fill-rule="evenodd" d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z"></path>
</svg>Kotlin</a>
<a class="muted-link mr-3 d-inline-block" href=/tags/viewbinding><svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
  <path fill-rule="evenodd" d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z"></path>
</svg>ViewBinding</a>
<a class="muted-link mr-3 d-inline-block" href=/tags/kotlin-android-extensions><svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
  <path fill-rule="evenodd" d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z"></path>
</svg>Kotlin Android Extensions</a>
<a class="muted-link mr-3 d-inline-block" href=/tags/synthetics><svg class="octicon octicon-tag" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true">
  <path fill-rule="evenodd" d="M2.5 7.775V2.75a.25.25 0 01.25-.25h5.025a.25.25 0 01.177.073l6.25 6.25a.25.25 0 010 .354l-5.025 5.025a.25.25 0 01-.354 0l-6.25-6.25a.25.25 0 01-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 010 2.474l-5.026 5.026a1.75 1.75 0 01-2.474 0l-6.25-6.25A1.75 1.75 0 011 7.775zM6 5a1 1 0 100 2 1 1 0 000-2z"></path>
</svg>synthetics</a></div></div><div class="d-block text-small text-gray"><span class=d-inline-block>Created at <time datetime="2020-11-29 15:40" class=no-wrap>2020-11-29 15:40</time></span></span></div></h1></div></div></div><div class="container-lg clearfix new-discussion-timeline experiment-repo-nav p-responsive"><div class=repository-content><div class="Box mt-3 position-relative"><div class="Box-header py-2 d-flex flex-column flex-shrink-0 flex-md-row flex-md-items-center"><div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">3699 Words</div><div class="d-flex py-1 py-md-0 flex-auto flex-order-1 flex-md-order-2 flex-sm-grow-0 flex-justify-between"><div class=BtnGroup><a rel=nofollow class="btn btn-sm BtnGroup-item" href=https://github.com/suihan74/hugo_files/commits/master/content/posts/2020/11_29_00_view_binding.md>History</a></div></div></div><div id=readme class="Box-body readme blob instapaper_body js-code-block-container"><article class="markdown-body entry-content p-3 p-md-6" itemprop=text><p>Kotlinを<code>1.4.20</code>にアップデートしたら「<code>'kotlin-android-extensions'</code>は非推奨になったからよ、<code>ViewBinding</code>使ってくれや」というメッセージが出てきて初めて気づいたやつ。</p><p><a href=https://developer.android.com/topic/libraries/view-binding/migration target=_blank>Migrate from Kotlin synthetics to Jetpack view binding</a></p><p><a href=https://developer.android.com/topic/libraries/view-binding target=_blank>ビュー バインディング | Android デベロッパー | Android Developers</a></p><p>公式のリファレンスが普通に読みやすいのでとくに書くこと無いのだが、<code>Kotlin synthetics</code>からの移行作業が少々面倒だったのでその記録。</p><p>なお、<code>synthetics</code>は2021年9月かそのくらいには削除されるみたい。</p><p><a href=https://developers-jp.googleblog.com/2020/11/the-future-of-kotlin-android-extensions.html target=_blank>Google Developers Japan: Kotlin Android Extensions の未来</a></p><hr><h2 id=findviewbyid>findViewById<a class=anchor aria-hidden=true href=#findviewbyid><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><p>コード側から<code>View</code>を参照する原始的な方法は<code>findViewById(id)</code>メソッドを使用することである。</p><div class=highlight><pre class=chroma><code class=language-xml data-lang=xml><span class=nt>&lt;Button</span>
    <span class=na>android:id=</span><span class=s>&#34;@+id/hoge&#34;</span>
    <span class=na>android:layout_width=</span><span class=s>&#34;wrap_content&#34;</span>
    <span class=na>android:layout_height=</span><span class=s>&#34;wrap_content&#34;</span><span class=nt>/&gt;</span>
</code></pre></div><div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=k>val</span> <span class=py>button</span> <span class=p>=</span> <span class=n>activity</span><span class=p>.</span><span class=n>findViewById</span><span class=p>&lt;</span><span class=n>Button</span><span class=p>&gt;(</span><span class=n>R</span><span class=p>.</span><span class=n>id</span><span class=p>.</span><span class=n>hoge</span><span class=p>)</span>
</code></pre></div><h3 id=問題点>問題点<a class=anchor aria-hidden=true href=#問題点><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><ul><li><p><strong>レイアウトの変更時にコードを直し忘れると実行するまで気づかない</strong></p><p>先例の場合、IDが変更されたり<code>Button</code>以外に変更したり、という変更を施した場合、コードの方を修正していなくてもビルドまで通ってしまう。</p></li><li><p><strong>存在しないIDを参照できる</strong></p><p>同根の問題だが、対象のレイアウトには存在しない<code>View</code>のIDを参照しようとすることができてしまう。(結果はnull)</p></li><li><p><strong>型安全ではない、null安全ではない</strong></p><p>要するに以上の問題はそういうこと。扱おうとしている型が正しいかどうか分からない、参照先が存在しないかもしれない。結果が<code>T!型</code>なのでKotlinでは<code>nullable</code>として扱うのが最も安全だが、その辺の判断が開発者に委ねられるふわっと感がある。</p></li><li><p><strong>結果がキャッシュされない</strong></p><p>呼び出すたびに子を順番に探索して指定した<code>View</code>を取得し直す。(自分で参照結果を保持しておく必要がある)</p></li><li><p><strong>いちいち長い</strong></p><p>型をこちらで指定して、IDを間違いなく指定して、findViewById</p></li></ul><h2 id=kotlin-synthetics>kotlin synthetics<a class=anchor aria-hidden=true href=#kotlin-synthetics><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><p><code>Kotlin Android Extensions</code>に含まれる<code>View</code>参照を拡張プロパティ化する仕組み。<br>レイアウトファイルごとに自動生成されるコードをインポートすることで、<code>Activity</code>や<code>View</code>の子<code>View</code>を拡張プロパティとして参照することができるようになる。</p><div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=k>import</span> <span class=nn>kotlinx.android.synthetic.main.activity_main.*</span>

<span class=k>val</span> <span class=py>button</span> <span class=p>=</span> <span class=n>activity</span><span class=p>.</span><span class=n>hoge</span>
</code></pre></div><h3 id=問題点-1>問題点<a class=anchor aria-hidden=true href=#問題点-1><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><ul><li><p><strong>どこからでも参照できる</strong></p><p>たとえば<code>Activity</code>は基本的にはアタッチされた<code>Fragment</code>側から参照することができるが、<code>Fragment</code>側のコードで<code>Activity</code>のレイアウト用の拡張をインポートすれば、<code>Activity</code>のすべての<code>View</code>に直接アクセスすることができる。(開発者が参照を間違う可能性も当然ある)<br>場合によっては楽でいいが、外に見せる必要のないものは見えないようにしておくべきである。</p></li><li><p><strong>関係ないレイアウト用の拡張をインポートできる</strong></p><p>同じIDの<code>View</code>がある複数のレイアウトファイルが存在する場合、コード補完時にそのファイル分だけインポート候補が表示されるので、うっかりミスる可能性はある。(早々間違えないが可能性はゼロではない)</p></li><li><p><strong>参照結果が一部キャッシュされない場合がある(らしい)</strong></p></li><li><p><strong>拡張プロパティである</strong></p><p>故にKotlinでしか使えない(Javaで使えない)。これは個人的にはどうでもいい。<br>拡張プロパティなのでインポートさえすれば<code>Activity</code>やら<code>View</code>やらにいくらでも生えて煩雑になる。</p></li><li><p><strong><code>View</code>のIDをスネークケースで書いている場合、プロパティ命名規則的にキモい</strong></p><p>IDを<code>@+id/hoge_button</code>とかしているとそれがそのままプロパティ名になるので、基本キャメルケースで書いてあるはずのコードに<code>root.hoge_button</code>とかを書かなくてはならなくなる。(それかIDを全て書き直すことになる)<br>結果的に「これは<code>View</code>の参照である」という目印になってある意味分かりやすくもあるが。</p></li></ul><h2 id=viewbinding>ViewBinding<a class=anchor aria-hidden=true href=#viewbinding><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><p>(アプリ開発者から見える表面上の)コード側では<code>DataBinding</code>とほぼ同じように<code>View</code>参照が扱える仕組み。</p><h3 id=activityの場合><code>Activity</code>の場合<a class=anchor aria-hidden=true href=#activityの場合><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=k>override</span> <span class=k>fun</span> <span class=nf>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>:</span> <span class=n>Bundle</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>super</span><span class=p>.</span><span class=n>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>)</span>

    <span class=k>val</span> <span class=py>binding</span> <span class=p>=</span> <span class=n>ActivityMainBinding</span><span class=p>.</span><span class=n>inflate</span><span class=p>(</span><span class=n>layoutInflater</span><span class=p>)</span>
    <span class=n>setContentView</span><span class=p>(</span><span class=n>binding</span><span class=p>.</span><span class=n>root</span><span class=p>)</span>

    <span class=k>val</span> <span class=py>button</span> <span class=p>=</span> <span class=n>binding</span><span class=p>.</span><span class=n>hoge</span>
<span class=p>}</span>
</code></pre></div><h3 id=fragmentの場合><code>Fragment</code>の場合<a class=anchor aria-hidden=true href=#fragmentの場合><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=k>override</span> <span class=k>fun</span> <span class=nf>onCreateView</span><span class=p>(</span>
    <span class=n>inflater</span><span class=p>:</span> <span class=n>LayoutInflater</span><span class=p>,</span>
    <span class=n>container</span><span class=p>:</span> <span class=n>ViewGroup</span><span class=p>?,</span>
    <span class=n>savedInstanceState</span><span class=p>:</span> <span class=n>Bundle</span><span class=p>?</span>
<span class=p>)</span> <span class=p>:</span> <span class=n>View</span> <span class=p>{</span>
    <span class=k>val</span> <span class=py>binding</span> <span class=p>=</span> <span class=n>FragmentHogeBinding</span><span class=p>.</span><span class=n>inflate</span><span class=p>(</span>
        <span class=n>inflater</span><span class=p>,</span>
        <span class=n>container</span><span class=p>,</span>
        <span class=k>false</span>
    <span class=p>)</span>

    <span class=k>val</span> <span class=py>button</span> <span class=p>=</span> <span class=n>binding</span><span class=p>.</span><span class=n>hoge</span>

    <span class=k>return</span> <span class=n>binding</span><span class=p>.</span><span class=n>root</span>
<span class=p>}</span>
</code></pre></div><h3 id=fragmentでbindingを保持し続ける場合><code>Fragment</code>で<code>binding</code>を保持し続ける場合<a class=anchor aria-hidden=true href=#fragmentでbindingを保持し続ける場合><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=k>private</span> <span class=k>var</span> <span class=py>_binding</span> <span class=p>:</span> <span class=n>FragmentHogeBinding</span><span class=p>?</span> <span class=p>=</span> <span class=k>null</span>
<span class=k>private</span> <span class=k>val</span> <span class=py>binding</span>
    <span class=k>get</span><span class=p>()</span> <span class=p>=</span> <span class=n>_binding</span><span class=o>!!</span>

<span class=k>override</span> <span class=k>fun</span> <span class=nf>onCreateView</span><span class=p>(</span>
    <span class=n>inflater</span><span class=p>:</span> <span class=n>LayoutInflater</span><span class=p>,</span>
    <span class=n>container</span><span class=p>:</span> <span class=n>ViewGroup</span><span class=p>?,</span>
    <span class=n>savedInstanceState</span><span class=p>:</span> <span class=n>Bundle</span><span class=p>?</span>
<span class=p>)</span> <span class=p>:</span> <span class=n>View</span> <span class=p>{</span>
    <span class=n>_binding</span> <span class=p>=</span> <span class=n>FragmentHogeBinding</span><span class=p>.</span><span class=n>inflate</span><span class=p>(</span>
        <span class=n>inflater</span><span class=p>,</span>
        <span class=n>container</span><span class=p>,</span>
        <span class=k>false</span>
    <span class=p>)</span>

    <span class=k>val</span> <span class=py>button</span> <span class=p>=</span> <span class=n>binding</span><span class=p>.</span><span class=n>hoge</span>

    <span class=k>return</span> <span class=n>binding</span><span class=p>.</span><span class=n>root</span>
<span class=p>}</span>

<span class=cm>/**
</span><span class=cm> * FragmentはViewが破棄されても生き続ける場合があるので、
</span><span class=cm> * Viewが破棄された時点で参照を解く
</span><span class=cm> */</span>
<span class=k>override</span> <span class=k>fun</span> <span class=nf>onDestroyView</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>super</span><span class=p>.</span><span class=n>onDestroyView</span><span class=p>()</span>
    <span class=n>_binding</span> <span class=p>=</span> <span class=k>null</span>
<span class=p>}</span>
</code></pre></div><h3 id=利点>利点<a class=anchor aria-hidden=true href=#利点><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><ul><li><p><strong>レイアウトとコードで齟齬が発生しない</strong></p><p>各レイアウトファイルごとに<code>ViewBinding</code>を継承した専用のクラスが生成され、それを使って紐づいたレイアウトを直接生成するので、コード側ではレイアウトリソースIDを扱う必要が一切なくなった。そのうえ<code>View</code>の参照は<code>binding</code>のプロパティを通して行うので「存在しない<code>View</code>を参照しようとする」ことは原理的に不可能になった。</p></li><li><p><strong>型安全、null安全</strong></p><p>先の点に関連して、参照時に「型が合っているか」「nullではないか(<code>T!型</code>)」を気にする必要がなくなった。</p><p>画面の向き専用のレイアウトファイルを用意していて、向きによっては特定の<code>View</code>が存在しない場合には、対応するプロパティは自動的に<code>nullable型</code>になる。<code>T!型</code>ではないので<code>null</code>かどうかを気にする必要がそもそもあるのか無いのかに悩む必要がない。</p></li><li><p><strong>キャッシュがはたらく</strong></p><p>どのような場合でも<code>ViewBinding</code>内部でしっかり<code>View</code>参照をキャッシュしてくれる。</p><p>自動生成されたコードを見てみると、<code>bind()</code>が呼ばれたとき(<code>inflate()</code>したとき)に内包するすべての<code>View</code>に対して<code>findViewById()</code>を行うようだ。<br>なので、コード側で参照しない<code>View</code>が沢山あると初期化時に無駄なキャッシュ処理が大量に挟まることにはなるが。<br>ちなみに、この処理が行われたとき(<code>inflate</code>or<code>bind</code>)に「あるはずの<code>View</code>が見つからない」不具合が起きていたらヌルポを飛ばしてくれる。</p></li><li><p><strong><code>binding</code>の扱い方が<code>DataBinding</code>とほぼ可換</strong></p><p>「途中まで<code>ViewBinding</code>で書いていたが、動的な値更新がある箇所が増えたから<code>DataBinding</code>に変えたい」とかその逆とかで書き換えたくなった時に、コード表面上での取り扱い方はほぼ同じなので移行が楽。</p><p>ちなみに「<code>DataBinding</code>使えるならそっち使えばいいじゃんMVVMでいいじゃん」については、値更新がない(少ない)場合などについては<code>ViewBinding</code>の方が(MVC的にやった方が)軽量でシンプルであるという利点はある。</p></li></ul><h3 id=自動生成されたコードがある場所>自動生成されたコードがある場所<a class=anchor aria-hidden=true href=#自動生成されたコードがある場所><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><p><code>(ProjectRoot)/app/build/generated/data_binding_base_class_source_out/debug/out/(com)/(hoge)/(appName)/databinding/~Binding.java</code></p><p>AndroidStudioで(<code>ViewBinding</code> <code>DataBinding</code>問わず)<code>HogeBinding</code>クラスの宣言を開こうとするとレイアウトファイルが開かれるため、これらのファイルは普通直接開くことはない。こういう記事を書くとかしなければ普通にそれがありがたい。</p><hr><h2 id=syntheticsからviewbindingへの移行>syntheticsからViewBindingへの移行<a class=anchor aria-hidden=true href=#syntheticsからviewbindingへの移行><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h2><p>これから新規にプロジェクトを始める場合には<code>ViewBinding</code>+<code>DataBinding</code>で始めればいいのだが、既に<code>synthetics</code>を使用していた場合の移行作業は少々手間だった。</p><p>行った作業を以下に書いておく。</p><h3 id=アプリレベルのbuildgradleを修正>アプリレベルの<code>build.gradle</code>を修正<a class=anchor aria-hidden=true href=#アプリレベルのbuildgradleを修正><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><p><a href=https://developer.android.com/topic/libraries/view-binding/migration target=_blank>Migrate from Kotlin synthetics to Jetpack view binding</a></p><ol><li><p>以下を削除</p><div class=highlight><pre class=chroma><code class=language-gradle data-lang=gradle><span class=n>apply</span> <span class=nl>plugin:</span> <span class=err>`</span><span class=n>kotlin</span><span class=o>-</span><span class=n>android</span><span class=o>-</span><span class=n>extensions</span><span class=err>`</span>

<span class=n>androidExtensions</span> <span class=o>{</span>
    <span class=n>experimental</span> <span class=o>=</span> <span class=kc>true</span>
<span class=o>}</span>
</code></pre></div></li><li><p>以下を追加</p><div class=highlight><pre class=chroma><code class=language-gradle data-lang=gradle><span class=n>android</span> <span class=o>{</span>
    <span class=o>...</span>
    <span class=n>buildFeatures</span> <span class=o>{</span>
        <span class=n>viewBinding</span> <span class=kc>true</span>
        <span class=o>...</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></div></li></ol><h3 id=syntheticsのインポートをすべて削除する><code>synthetics</code>のインポートをすべて削除する<a class=anchor aria-hidden=true href=#syntheticsのインポートをすべて削除する><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=k>import</span> <span class=nn>kotlinx.android.synthetic.</span>
</code></pre></div><p>を検索してすべて削除。ヒットしたファイルで<code>synthetic</code>が使用されているので、次項からの修正を行う。</p><h3 id=activitysetcontentviewを置き換える><code>Activity#setContentView()</code>を置き換える<a class=anchor aria-hidden=true href=#activitysetcontentviewを置き換える><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><p><code>Activity#onCreate()</code>内でのレイアウト生成部分を書き換えた。</p><ul><li><p>移行前</p><div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=k>override</span> <span class=k>fun</span> <span class=nf>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>:</span> <span class=n>Bundle</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>super</span><span class=p>.</span><span class=n>onCreate</span><span class=p>()</span>
    <span class=n>setContentView</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=n>id</span><span class=p>.</span><span class=n>activity_hoge</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div></li><li><p>移行後</p><div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=k>override</span> <span class=k>fun</span> <span class=nf>onCreate</span><span class=p>(</span><span class=n>savedInstanceState</span><span class=p>:</span> <span class=n>Bundle</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>super</span><span class=p>.</span><span class=n>onCreate</span><span class=p>()</span>
    <span class=k>val</span> <span class=py>binding</span> <span class=p>=</span> <span class=n>ActivityHoge</span><span class=p>.</span><span class=n>inflate</span><span class=p>(</span><span class=n>layoutInflater</span><span class=p>)</span>
    <span class=n>setContentView</span><span class=p>(</span><span class=n>binding</span><span class=p>.</span><span class=n>root</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div></li></ul><h3 id=layoutinflaterinflateを置き換える><code>LayoutInflater#inflate()</code>を置き換える<a class=anchor aria-hidden=true href=#layoutinflaterinflateを置き換える><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><p><code>Fragment</code>や<code>ViewHolder</code>、カスタムビューなどで<code>LayoutInflater#inflate()</code>していた部分をすべて<code>ViewBinding#inflate()</code>に書き換えた。</p><ul><li><p>移行前</p><div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=k>val</span> <span class=py>inflater</span> <span class=p>=</span> <span class=n>LayoutInflater</span><span class=p>.</span><span class=n>from</span><span class=p>(</span><span class=n>activity</span><span class=p>)</span>
<span class=k>val</span> <span class=py>root</span> <span class=p>=</span> <span class=n>inflater</span><span class=p>.</span><span class=n>inflate</span><span class=p>(</span><span class=n>R</span><span class=p>.</span><span class=n>layout</span><span class=p>.</span><span class=n>fragment_hoge</span><span class=p>,</span> <span class=n>container</span><span class=p>,</span> <span class=k>false</span><span class=p>)</span>
</code></pre></div></li><li><p>移行後</p><div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=k>val</span> <span class=py>inflater</span> <span class=p>=</span> <span class=n>LayoutInflater</span><span class=p>.</span><span class=n>from</span><span class=p>(</span><span class=n>activity</span><span class=p>)</span>
<span class=k>val</span> <span class=py>binding</span> <span class=p>=</span> <span class=n>FragmentHogeBinding</span><span class=p>.</span><span class=n>inflate</span><span class=p>(</span><span class=n>inflater</span><span class=p>,</span> <span class=n>container</span><span class=p>,</span> <span class=k>false</span><span class=p>)</span>
<span class=k>val</span> <span class=py>root</span> <span class=p>=</span> <span class=n>binding</span><span class=p>.</span><span class=n>root</span>
</code></pre></div></li></ul><h3 id=view参照を置き換える><code>View</code>参照を置き換える<a class=anchor aria-hidden=true href=#view参照を置き換える><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><p>IDをスネークケースでつけている場合、それらをすべてローワーキャメルケースで書き直す必要がある。</p><ul><li><p>変更前</p><p><code>Activity</code>の場合</p><div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=k>val</span> <span class=py>hoge</span> <span class=p>=</span> <span class=n>hoge_button</span>
</code></pre></div><p><code>Fragment</code>などで<code>View</code>の子を参照している場合</p><div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=k>val</span> <span class=py>hoge</span> <span class=p>=</span> <span class=n>root</span><span class=p>.</span><span class=n>hoge_button</span>
<span class=c1>// or
</span><span class=c1></span><span class=k>val</span> <span class=py>hoge2</span> <span class=p>=</span> <span class=n>view</span><span class=o>?.</span><span class=n>hoge_button</span><span class=o>!!</span>
</code></pre></div></li><li><p>変更後</p><div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=k>val</span> <span class=py>hoge</span> <span class=p>=</span> <span class=n>binding</span><span class=p>.</span><span class=n>hogeButton</span>
</code></pre></div><p>すべての箇所を<code>binding</code>を経由して参照するように書き直す必要があるので、場合によっては<code>Activity</code>や<code>Fragment</code>に<code>binding</code>をプロパティとして保持するように書き足すとか、<code>Activity#onCreate</code>やら<code>Fragment#onCreateView</code>やらから他のメソッドを呼ぶ際の引数にする必要がある。</p></li></ul><h3 id=外部からの直接的なview参照を修正する>外部からの直接的な<code>View</code>参照を修正する<a class=anchor aria-hidden=true href=#外部からの直接的なview参照を修正する><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a></h3><p>(そもそもそんなことするなよというのは置いておく)</p><ul><li><p>変更前</p><div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=c1>// たとえば子のフラグメント側で
</span><span class=c1></span><span class=k>val</span> <span class=py>hogeActivity</span> <span class=p>=</span> <span class=n>requireActivity</span><span class=p>()</span> <span class=k>as</span> <span class=n>HogeActivity</span>
<span class=k>val</span> <span class=py>activityToolbar</span> <span class=p>=</span> <span class=n>hogeActivity</span><span class=p>.</span><span class=n>toolbar</span>
</code></pre></div></li><li><p>変更後</p><p><code>Activity</code></p><div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=k>class</span> <span class=nc>HogeActivity</span> <span class=p>:</span> <span class=n>AppCompatActivity</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>private</span> <span class=k>lateinit</span> <span class=k>var</span> <span class=py>binding</span> <span class=p>:</span> <span class=n>ActivityHogeBinding</span>
    <span class=p>...</span>
    <span class=k>val</span> <span class=py>toolbar</span> <span class=p>:</span> <span class=n>Toolbar</span>
        <span class=k>get</span><span class=p>()</span> <span class=p>=</span> <span class=n>binding</span><span class=p>.</span><span class=n>toolbar</span>
    <span class=p>...</span>
<span class=p>}</span>
</code></pre></div><p>子<code>Fragment</code></p><div class=highlight><pre class=chroma><code class=language-kt data-lang=kt><span class=k>val</span> <span class=py>hogeActivity</span> <span class=p>=</span> <span class=n>requireActivity</span><span class=p>()</span> <span class=k>as</span> <span class=n>HogeActivity</span>
<span class=k>val</span> <span class=py>activityToolbar</span> <span class=p>=</span> <span class=n>hogeActivity</span><span class=p>.</span><span class=n>toolbar</span>
</code></pre></div></li></ul></article></div></div></div></div></main></div></div><script src=https://suihan74.github.io/js/syntax-highlight-title.js crossorigin=anonymous type=application/javascript></script><div class=utterances></div><script>var utterancesTheme='github-light'
var utterancesScript=document.createElement('script');utterancesScript.src='https://utteranc.es/client.js';utterancesScript.setAttribute('repo','suihan74\/suihan74.github.io');utterancesScript.setAttribute('issue-term','title');utterancesScript.setAttribute('theme',utterancesTheme);utterancesScript.setAttribute('crossorigin','anonymous');utterancesScript.setAttribute('async','');document.querySelector('.utterances').appendChild(utterancesScript);</script><noscript>Please enable JavaScript to view the comments</noscript><div class="footer container-lg width-full p-responsive" role=contentinfo><div class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light"><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"><li class="mr-3 mr-lg-0">© 2021 すいはん. Theme by <a href=https://github.com/MeiK2333/github-style><span>github-style</span></a> (<a href=https://github.com/suihan74/github-style><span>customized</span></a>)</li></ul><a aria-label=Homepage title=すいはんぶろぐ.io class="footer-octicon d-none d-lg-block mx-lg-4" href=https://suihan74.github.io/><svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24"
                aria-hidden="true">
                <path style="fill-rule:evenodd" d="M 8,0 C 3.58,0 0,3.58 0,8 c 0,3.54 2.29,6.53 5.47,7.59 0.4,0.07 0.55,-0.17 0.55,-0.38 0,-0.19 -0.077797,-1.481017 -0.077797,-2.151017 C 5.9433346,12.597005 6.1160655,11.824118 6.56,11.53 4.78,11.33 3.8013559,10.978983 3.5810169,7.6647458 3.9355372,4.6446549 5.3653277,3.8240736 8.0538984,3.639661 10.967753,3.8102868 12.141357,4.4459308 12.425085,7.6477967 12.255593,10.378813 11.25,11.33 9.47,11.53 c 0.29,0.25 0.54,0.73 0.54,1.48 0,1.07 -0.01,1.93 -0.01,2.2 0,0.21 0.15,0.46 0.55,0.38 C 13.806446,14.490656 15.999121,11.437004 16,8 16,3.58 12.42,0 8,0 Z" />
                <rect style="fill-rule:evenodd" ry="0.23728813" y="6.3898306" x="6.0169492" height="1.0847455" width="3.9830508"/>
                
            </svg></a><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"></ul></div><div class="d-flex flex-justify-center pb-6"><span class="f6 text-gray-light"></span></div></div><script crossorigin=anonymous type=application/javascript src=https://suihan74.github.io/js/frameworks.js></script><script crossorigin=anonymous type=application/javascript src=https://suihan74.github.io/js/github-bootstrap.js></script><script src=https://suihan74.github.io/js/stop.js></script><script src=https://suihan74.github.io/js/contributions.js></script><script src=https://suihan74.github.io/js/lightbox-plus-jquery.min.js></script><script>lightbox.option({'disableScrolling':true})</script></body></html>