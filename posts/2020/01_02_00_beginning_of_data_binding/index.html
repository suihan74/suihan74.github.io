<!doctype html><html lang=ja><head><meta charset=utf-8><link crossorigin=anonymous media=all rel=stylesheet href=https://suihan74.github.io/css/frameworks.css?20200607150521><link crossorigin=anonymous media=all rel=stylesheet href=https://suihan74.github.io/css/github.css?20200607150521><link crossorigin=anonymous media=all rel=stylesheet href=https://suihan74.github.io/css/user.css?20200607150521><meta name=viewport content="width=device-width"><title>Android - DataBindingはじめ - すいはんぶろぐ.io</title><meta property="og:url" content="https://suihan74.github.io/posts/2020/01_02_00_beginning_of_data_binding/"><meta property="og:site_name" content="すいはんぶろぐ.io"><meta property="og:type" content="article"><meta property="og:title" content="Android - DataBindingはじめ"><meta property="og:description" content="いまさらAndroidでDataBinding触れはじめてみた浅い記事"><meta name=description content="いまさらAndroidでDataBinding触れはじめてみた浅い記事"><link rel=icon type=image/x-icon class=js-site-favicon href=https://suihan74.github.io/favicon.ico><link rel="shortcut icon" href=https://suihan74.github.io/favicon.ico><meta name=theme-color content="#1e2327"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-71542625-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-71542625-2');</script></head><body class="env-production emoji-size-boost page-responsive page-profile"><div class="position-relative js-header-wrapper"><span class="Progress progress-pjax-loader position-fixed width-full js-pjax-loader-bar"><span class="progress-pjax-loader-bar top-0 left-0" style=width:0%></span></span><div class="Header js-details-container Details flex-wrap flex-lg-nowrap p-responsive" role=banner><div class="Header-item d-none d-lg-flex"><a class=Header-link href=https://suihan74.github.io/ aria-label=Homepage data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" width="32" aria-hidden="true"><path style="fill-rule:evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.077797-1.481017-.077797-2.151017C5.9433346 12.597005 6.1160655 11.824118 6.56 11.53 4.78 11.33 3.8013559 10.978983 3.5810169 7.6647458 3.9355372 4.6446549 5.3653277 3.8240736 8.0538984 3.639661 10.967753 3.8102868 12.141357 4.4459308 12.425085 7.6477967 12.255593 10.378813 11.25 11.33 9.47 11.53c.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38C13.806446 14.490656 15.999121 11.437004 16 8c0-4.42-3.58-8-8-8z" /><rect style="fill-rule:evenodd" ry=".23728813" y="6.3898306" x="6.0169492" height="1.0847455" width="3.9830508"/></svg><span style=margin-left:8px>すいはんぶろぐ.io</span></a></div><div class="Header-item Header-item--full flex-column flex-lg-row width-full flex-order-2 flex-lg-order-none mr-0 mr-lg-3 mt-3 mt-lg-0 Details-content--hidden"><div class="header-search flex-self-stretch flex-lg-self-auto mr-0 mr-lg-3 mb-3 mb-lg-0 scoped-search site-scoped-search js-site-search position-relative js-jump-to" role=combobox aria-owns=jump-to-results aria-label="Search or jump to" aria-haspopup=listbox aria-expanded=false><div class=position-relative></div></div></div><div class="Header-item Header-item--full flex-justify-center d-lg-none position-relative" style=margin-right:auto><a class=Header-link href=https://suihan74.github.io/ aria-label=Homepage data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" width="32" aria-hidden="true"><path style="fill-rule:evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.077797-1.481017-.077797-2.151017C5.9433346 12.597005 6.1160655 11.824118 6.56 11.53 4.78 11.33 3.8013559 10.978983 3.5810169 7.6647458 3.9355372 4.6446549 5.3653277 3.8240736 8.0538984 3.639661 10.967753 3.8102868 12.141357 4.4459308 12.425085 7.6477967 12.255593 10.378813 11.25 11.33 9.47 11.53c.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38C13.806446 14.490656 15.999121 11.437004 16 8c0-4.42-3.58-8-8-8z" /><rect style="fill-rule:evenodd" ry=".23728813" y="6.3898306" x="6.0169492" height="1.0847455" width="3.9830508"/></svg>すいはんぶろぐ.io</a></div><div class="Header-item position-relative mr-0 d-none d-lg-flex Details-content--hidden"><div class="header-search flex-self-stretch flex-lg-self-auto mr-0 mr-lg-3 mb-3 mb-lg-0 position-relative js-jump-to"><div class=position-relative><form class=js-site-search-form role=search action=https://cse.google.com/cse method=get><input type=hidden name=cx value=006598476776954487838:x6qvcxfxgqt>
<label class="form-control input-sm header-search-wrapper p-0 header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center js-chromeless-input-container"><input type=text class="form-control input-sm header-search-input" name=q placeholder=Search autocapitalize=off aria-label=Search spellcheck=false onkeydown="if(event.keyCode==13){if(this.value.length){document.getElementById('header-search-submit').click();return false}else{return false}};" autocomplete=off>
<button id=header-search-submit class="mr-1 ml-1 header-search-button" type=submit><svg class="header-search-button-icon" width="13" height="13" viewBox="0 0 13 13"><title>サイト内検索</title><path d="m4.8495 7.8226c.82666.0 1.5262-.29146 2.0985-.87438.57232-.58292.86378-1.2877.87438-2.1144.010599-.82666-.28086-1.5262-.87438-2.0985-.59352-.57232-1.293-.86378-2.0985-.87438-.8055-.010599-1.5103.28086-2.1144.87438-.60414.59352-.8956 1.293-.87438 2.0985.021197.8055.31266 1.5103.87438 2.1144.56172.60414 1.2665.8956 2.1144.87438zm4.4695.2115 3.681 3.6819-1.259 1.284-3.6817-3.7.0019784-.69479-.090043-.098846c-.87973.76087-1.92 1.1413-3.1207 1.1413-1.3553.0-2.5025-.46363-3.4417-1.3909s-1.4088-2.0686-1.4088-3.4239.4696-2.4966 1.4088-3.4239c.9392-.92727 2.0864-1.3969 3.4417-1.4088 1.3553-.011889 2.4906.45771 3.406 1.4088.9154.95107 1.379 2.0924 1.3909 3.4239.0 1.2126-.38043 2.2588-1.1413 3.1385l.098834.090049z"/></svg></button></label></form></div></div></div></header></div><div id=start-of-content class=show-on-focus></div><div id=js-flash-container></div><div class=application-main data-commit-hovercards-enabled><div itemscope itemtype=http://schema.org/SoftwareSourceCode><main id=js-repo-pjax-container data-pjax-container><div class="pagehead repohead instapaper_ignore readability-menu experiment-repo-nav pt-lg-4"><div class="repohead-details-container clearfix container-lg p-responsive d-lg-block"><div class="mb-3 d-flex"><h1 class="public css-truncate float-none flex-auto width-fit pl-0"><a class="avatar mr-1" href=https://suihan74.github.io/about/><img src=/images/author.png width=26 height=26></a>
<span class=author><a href=https://suihan74.github.io/about/>すいはん</a></span>
<span class=path-divider>/</span>
<strong itemprop=name><a href=https://suihan74.github.io/posts/2020/01_02_00_beginning_of_data_binding/>Android - DataBindingはじめ</a></strong><div class="text-small text-gray">いまさらAndroidでDataBinding触れはじめてみた浅い記事</div><div class="text-small text-gray"><svg class="octicon octicon-tag" viewBox="0 0 14 16" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.73 1.73C7.26 1.26 6.62 1 5.96 1H3.5C2.13 1 1 2.13 1 3.5v2.47c0 .66.27 1.3.73 1.77l6.06 6.06c.39.39 1.02.39 1.41.0l4.59-4.59a.996.996.0 000-1.41L7.73 1.73zM2.38 7.09c-.31-.3-.47-.7-.47-1.13V3.5c0-.88.72-1.59 1.59-1.59h2.47c.42.0.83.16 1.13.47l6.14 6.13-4.73 4.73-6.13-6.15zM3.01 3h2v2H3V3h.01z" /></svg><a href=/tags/android/>android</a> <a href=/tags/kotlin/>kotlin</a> <a href=/tags/databinding/>DataBinding</a> <a href=/tags/viewmodel/>ViewModel</a> <a href=/tags/livedata/>LiveData</a></div><div class="d-block text-small text-gray">Created at <time datetime="2020-01-02 17:04" class=no-wrap>2020/01/02 17:04</time>
<span class=file-info-divider></span>Updated at <time datetime="2020-03-31 17:50" class=no-wrap>2020/03/31 17:50</time></div></h1></div></div></div><div class="container-lg clearfix new-discussion-timeline experiment-repo-nav p-responsive"><div class=repository-content><div class="Box mt-3 position-relative"><div class="Box-header py-2 d-flex flex-column flex-shrink-0 flex-md-row flex-md-items-center"><div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">2471 Words</div><div class="d-flex py-1 py-md-0 flex-auto flex-order-1 flex-md-order-2 flex-sm-grow-0 flex-justify-between"><div class=BtnGroup><a rel=nofollow class="btn btn-sm BtnGroup-item" href=https://github.com/suihan74/hugo_files/commits/master/content/posts/2020/01_02_00_beginning_of_data_binding.md>History</a></div></div></div><div id=readme class="Box-body readme blob instapaper_body js-code-block-container"><article class="markdown-body entry-content p-3 p-md-6" itemprop=text><h2 id=追記-2020-03-31>追記 (2020-03-31)<a class=anchor aria-hidden=true href=#追記-2020-03-31><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a></h2><p>lifecycleに関する依存先のバージョンを<code>2.2.0</code>にアップデート。<br>それに伴い、<code>ViewModelProvider</code>を使用したViewModelのインスタンス生成方法を修正。</p><p><code>ViewModelProviders.of(owner)</code> → <code>ViewModelProvider(owner)</code></p><h2 id=追記-2020-03-10>追記 (2020-03-10)<a class=anchor aria-hidden=true href=#追記-2020-03-10><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a></h2><p><a href=/posts/2020/03_07_00_binding_adapter/>BindingAdapterに関するいくつかのこと - すいはんぶろぐ.io</a></p><p>関連する記事としてバインディングアダプタの使い方を書いた。</p><hr><p>最近ずっとSatenaのActivity/Fragmentのコード側を作り直す作業をしていて、ViewModel + LiveDataは割と活用してきて"前よりは"いい感じになってきているのだが、<br>DataBindingに関しては以前UWPアプリ作るとき（中途半端に）触れて以来、MVVMというかデータバインディングやったらやったでそれはそれで色々と面倒なことがあるイメージがあったので積極的に取り入れてなかったのだけど、楽できそうな部分ではやっていこうかと唐突に思った。</p><p>今さら感強い上にまだ詳しく使い込んでいないので、<br>とりあえず導入的なものと、<br>主に忘れそうな部分についていくつかメモを書く。</p><h2 id=導入>導入<a class=anchor aria-hidden=true href=#導入><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a></h2><h3 id=buildgradle-app>build.gradle (app)<a class=anchor aria-hidden=true href=#buildgradle-app><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a></h3><p>ViewModelやらDataBindingを使用するのに必要な設定・依存関係を追加する。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-gradle data-lang=gradle>android <span style=color:#f92672>{</span>
    <span style=color:#f92672>...</span>
    <span style=color:#75715e>// DataBinding利用に必要
</span><span style=color:#75715e></span>    dataBinding <span style=color:#f92672>{</span>
        enabled <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
    <span style=color:#f92672>}</span>
    <span style=color:#f92672>...</span>
<span style=color:#f92672>}</span>

dependencies <span style=color:#f92672>{</span>
    <span style=color:#f92672>...</span>
    <span style=color:#75715e>// ViewModel and LiveData
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>def</span> lifecycle_version <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;2.2.0&#34;</span>
    implementation <span style=color:#e6db74>&#34;androidx.lifecycle:lifecycle-extensions:$lifecycle_version&#34;</span>
    implementation <span style=color:#e6db74>&#34;androidx.lifecycle:lifecycle-viewmodel-ktx:$lifecycle_version&#34;</span>
    implementation <span style=color:#e6db74>&#34;androidx.lifecycle:lifecycle-common-java8:$lifecycle_version&#34;</span>
    testImplementation <span style=color:#e6db74>&#34;androidx.arch.core:core-testing:2.1.0&#34;</span>
    <span style=color:#f92672>...</span>
<span style=color:#f92672>}</span>
</code></pre></div><h3 id=activity_hogexml>activity_hoge.xml<a class=anchor aria-hidden=true href=#activity_hogexml><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a></h3><p>以前のレイアウトの内容を<code>&lt;layout></code>で囲い、<code>&lt;data> ~ &lt;/data></code>にバインドに必要な情報を記述する。<br>ここでは、コード側で用意してバインドする<code>ViewModel</code>のオブジェクトをレイアウトファイル内では<code>vm</code>として扱う。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
<span style=color:#f92672>&lt;layout</span> <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span><span style=color:#f92672>&gt;</span>
    <span style=color:#75715e>&lt;!-- bindするデータ --&gt;</span>
    <span style=color:#f92672>&lt;data&gt;</span>
        <span style=color:#f92672>&lt;variable</span>
                <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;vm&#34;</span>
                <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;com.suihan74.hoge.HogeViewModel&#34;</span> <span style=color:#f92672>/&gt;</span>
    <span style=color:#f92672>&lt;/data&gt;</span>

    <span style=color:#75715e>&lt;!-- 以下表示部分 --&gt;</span>
    <span style=color:#f92672>&lt;androidx.coordinatorlayout.widget.CoordinatorLayout</span>
        <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/hoge_layout&#34;</span>
        <span style=color:#a6e22e>android:background=</span><span style=color:#e6db74>&#34;?attr/panelBackground&#34;</span>
        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span><span style=color:#f92672>&gt;</span>

        ...

    <span style=color:#f92672>&lt;/androidx.coordinatorlayout.widget.CoordinatorLayout&gt;</span>
<span style=color:#f92672>&lt;/layout&gt;</span>
</code></pre></div><h3 id=hogeactivitykt>HogeActivity.kt<a class=anchor aria-hidden=true href=#hogeactivitykt><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a></h3><p>ActivityHogeBindingはレイアウトまで書いてビルドすると自動的に生成される。<br><code>ViewDataBinding</code>を継承した<code>"アッパーキャメルなレイアウトファイル名 + Binding"</code>という名前のクラスができるので、これを<code>DataBindingUtil.setContentView&lt;T>(...)</code>の型引数に与えて呼ぶとバインドが開始される。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kt data-lang=kt><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HogeActivity</span> : AppCompatActivity() {
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>lateinit</span> <span style=color:#66d9ef>var</span> viewModel: HogeViewModel
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>lateinit</span> <span style=color:#66d9ef>var</span> binding: ActivityHogeBinding

    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onCreate</span>(savedInstanceState: Bundle?) {
        <span style=color:#66d9ef>super</span>.onCreate(savedInstanceState)

        <span style=color:#75715e>// ViewModelの生成/取得
</span><span style=color:#75715e></span>        <span style=color:#75715e>// ViewModel用のFactoryを用意しておけばViewModelを生成する際コンストラクタに値を渡すことができる
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>val</span> factory = HogeViewModel.Factory(
            ...
        )
        viewModel = ViewModelProvider(<span style=color:#66d9ef>this</span>, factory)[HogeViewModel<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>.java]

        <span style=color:#75715e>// データバインド
</span><span style=color:#75715e></span>        binding = DataBindingUtil.setContentView&lt;ActivityHogeBinding&gt;(
            <span style=color:#66d9ef>this</span>,
            R.layout.activity_hoge
        ).apply {
            lifecycleOwner = <span style=color:#66d9ef>this</span>@BookmarkPostActivity
            vm = viewModel
        }
    }

    ...
}
</code></pre></div><p>バインドするデータに<code>LiveData</code>を使用する場合、作成した<code>binding</code>に適切な<code>lifecycleOwner</code>を渡す必要がある。これを行わないと<code>LiveData</code>の値変更がレイアウトにうまく通知されない。</p><p><code>ViewModel</code>を使うことで<code>savedInstanceState</code>はせいぜい初回起動か復元後かを判別する程度の用途しか無くなりましたとさ。良さ。</p><h2 id=データの変更をviewに反映する>データの変更をViewに反映する<a class=anchor aria-hidden=true href=#データの変更をviewに反映する><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a></h2><p>たとえば次のようなViewModelを用意するとする。<br><code>LiveData&lt;T></code>は<code>LiveData&lt;T>.value</code>が変更された際に生きている監視者に変更を通知するもの。<code>LiveData&lt;T></code>を継承して好きなように作ることもできるが、ここでは面倒なので<code>value</code>を外から変更できる<code>MutableLiveData&lt;T></code>を使うことにする。</p><h3 id=hogeviewmodelkt>HogeViewModel.kt<a class=anchor aria-hidden=true href=#hogeviewmodelkt><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a></h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kt data-lang=kt><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>HogeViewModel</span>(
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> repository : HogeRepository
) : ViewModel() {
    <span style=color:#66d9ef>val</span> text <span style=color:#66d9ef>by</span> lazy {
        MutableLiveData&lt;String&gt;(<span style=color:#e6db74>&#34;&#34;</span>)
    }

    ...

    <span style=color:#75715e>// DIできるよ的な例
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Factory</span>(
        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>val</span> repository : HogeRepository
    ) : ViewModelProvider.NewInstanceFactory() {
        @Suppress(<span style=color:#e6db74>&#34;UNCHECKED_CAST&#34;</span>)
        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> &lt;T : ViewModel?&gt; <span style=color:#a6e22e>create</span>(modelClass: Class&lt;T&gt;) =
            HogeViewModel(repository) <span style=color:#66d9ef>as</span> T
    }
}
</code></pre></div><p>これを先ほどのレイアウトファイルに<code>TextView</code>を追加して、データバインディングで表示するようにするには次のように<code>TextView</code>を記述する。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;TextView</span>
        <span style=color:#a6e22e>android:text=</span><span style=color:#e6db74>&#34;@{vm.text}&#34;</span>
        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span><span style=color:#f92672>/&gt;</span>
</code></pre></div><p><code>@{...}</code>でViewModel→Viewの単方向データバインディング。</p><p>これで<code>viewModel.text</code>が変更されたときに<code>TextView</code>の表示も変更されるようになる。楽。</p><h2 id=viewの変更をデータに反映する>Viewの変更をデータに反映する<a class=anchor aria-hidden=true href=#viewの変更をデータに反映する><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a></h2><p><code>EditText</code>の入力テキストを先ほどの<code>HogeViewModel.text</code>に反映する例。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;EditText</span>
        <span style=color:#a6e22e>android:text=</span><span style=color:#e6db74>&#34;@={vm.text}&#34;</span>
        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span><span style=color:#f92672>/&gt;</span>
</code></pre></div><p><code>@={...}</code>でViewModel⇔Viewの双方向データバインディング。</p><p>他にもチェックボックスやトグルボタンの状態管理など。</p><h2 id=真偽値をバインドしてvisibilityを変更する例>真偽値をバインドしてVisibilityを変更する例<a class=anchor aria-hidden=true href=#真偽値をバインドしてvisibilityを変更する例><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a></h2><p>楽そうだと思ったのはこれ。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml>...
<span style=color:#f92672>&lt;data&gt;</span>
    <span style=color:#f92672>&lt;import</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;android.view.View&#34;</span><span style=color:#f92672>/&gt;</span>
    ...
<span style=color:#f92672>&lt;/data&gt;</span>

...

<span style=color:#f92672>&lt;TextView</span>
        <span style=color:#a6e22e>android:text=</span><span style=color:#e6db74>&#34;@{vm.text}&#34;</span>
        <span style=color:#a6e22e>android:visibility=</span><span style=color:#e6db74>&#34;@{vm.display ? View.VISIBLE : View.GONE}&#34;</span>
        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span><span style=color:#f92672>/&gt;</span>
</code></pre></div><p>バインディング式にView.VISIBLEなどを記述する場合、<code>&lt;data>~&lt;/data></code>にて<code>View</code>をインポートする必要がある。</p><p>どうでもいいけど、最近kotlinばかり書いていて三項演算子懐かしいってなった。</p><p><a href="https://developer.android.com/topic/libraries/data-binding/expressions?hl=ja">レイアウトとバインディング式 | Android Developers</a></p><p>もっと凝ったことをする場合は、バインディングアダプターを用意する方法をとれば良さそう。</p><p><a href="https://developer.android.com/topic/libraries/data-binding/binding-adapters.html?hl=ja">バインディングアダプター | Android Developers</a></p><h2 id=双方向バインディングでconverterを介して値をやりとりする>双方向バインディングでConverterを介して値をやりとりする<a class=anchor aria-hidden=true href=#双方向バインディングでconverterを介して値をやりとりする><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a></h2><p>たとえば適当な列挙型<code>HogeEnum</code>があるとして、これを<code>Spinner</code>に表示して選択させたいときなどに以下のようなシングルトンを用意しておいて、レイアウトから呼ぶことができる。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kt data-lang=kt><span style=color:#66d9ef>object</span> <span style=color:#a6e22e>HogeEnumConverter</span> {
    @JvmStatic
    @InverseMethod(<span style=color:#e6db74>&#34;toHogeEnum&#34;</span>)
    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>toInt</span>(item: HogeEnum?) = item<span style=color:#f92672>?.</span>ordinal <span style=color:#f92672>?:</span> <span style=color:#ae81ff>0</span>

    @JvmStatic
    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>toHogeEnum</span>(ordinal: Int) = HogeEnum.values()[ordinal]
}
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#f92672>&lt;layout</span> <span style=color:#960050;background-color:#1e0010>...</span><span style=color:#f92672>&gt;</span>
    <span style=color:#f92672>&lt;data&gt;</span>
        <span style=color:#f92672>&lt;import</span> <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;com.suihan74.hoge.HogeEnumConverter&#34;</span><span style=color:#f92672>/&gt;</span>
        <span style=color:#f92672>&lt;variable</span>
                <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;vm&#34;</span>
                <span style=color:#a6e22e>type=</span><span style=color:#e6db74>&#34;com.suihan74.hoge.HogeViewModel&#34;</span> <span style=color:#f92672>/&gt;</span>
    <span style=color:#f92672>&lt;/data&gt;</span>

    ...

    <span style=color:#f92672>&lt;Spinner</span>
        <span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/spinner&#34;</span>
        <span style=color:#a6e22e>android:entries=</span><span style=color:#e6db74>&#34;@array/hogeEnums&#34;</span>
        <span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
        <span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
        <span style=color:#a6e22e>android:selectedItemPosition=</span><span style=color:#e6db74>&#34;@={HogeEnumConverter.toInt(vm.selectedHogeEnum)}&#34;</span> <span style=color:#f92672>/&gt;</span>

    ...
<span style=color:#f92672>&lt;/layout&gt;</span>
</code></pre></div><p><a href=https://medium.com/@star_zero/databinding%E3%81%AEinversemethod%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9-63f4effa49a0>DataBindingのInverseMethodの使い方 - Kenji Abe - Medium</a></p><h2 id=手をつけていないこと>手をつけていないこと<a class=anchor aria-hidden=true href=#手をつけていないこと><svg class="octicon octicon-link" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5.0-3-1.69-3-3.5S2.55 3 4 3h4c1.45.0 3 1.69 3 3.5.0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98.0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98.0-2-1.22-2-2.5.0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45.0 3-1.69 3-3.5S14.5 6 13 6z"/></svg></a></h2><p>以上のように特にシンプルな部分に関してはデータバインディング使っておけば基本的には楽そうである。</p><p>まだ詳しく知らないのだけども、<code>RecyclerView</code>と合わせて使うのは面倒臭そうだなぁと思ったり、イベントの処理はコード側に書けばいいんじゃないかなぁとか思ったりしている。</p><p>「全ての画面をばっちりMVVM的な感じに書き直してやるぜ」という気分には今さらあまりなれないものの、変に複雑なことになったりハマったりしないで使えそうなところではやっていこうかなという感じになった。<br>よかったですね。</p></article></div></div></div></div></main></div></div><div class=utterances><script src=https://utteranc.es/client.js repo=suihan74/suihan74.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script></div><div class="footer container-lg width-full p-responsive" role=contentinfo><div class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light"><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"><li class="mr-3 mr-lg-0">© 2020 すいはん. Theme by <a href=https://github.com/MeiK2333/github-style><span>github-style</span></a> (<a href=https://github.com/suihan74/github-style><span>customized</span></a>)</li></ul><a aria-label=Homepage title=すいはんぶろぐ.io class="footer-octicon d-none d-lg-block mx-lg-4" href=https://suihan74.github.io/><svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" width="24" aria-hidden="true"><path style="fill-rule:evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.077797-1.481017-.077797-2.151017C5.9433346 12.597005 6.1160655 11.824118 6.56 11.53 4.78 11.33 3.8013559 10.978983 3.5810169 7.6647458 3.9355372 4.6446549 5.3653277 3.8240736 8.0538984 3.639661 10.967753 3.8102868 12.141357 4.4459308 12.425085 7.6477967 12.255593 10.378813 11.25 11.33 9.47 11.53c.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38C13.806446 14.490656 15.999121 11.437004 16 8c0-4.42-3.58-8-8-8z" /><rect style="fill-rule:evenodd" ry=".23728813" y="6.3898306" x="6.0169492" height="1.0847455" width="3.9830508"/></svg></a><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"></ul></div><div class="d-flex flex-justify-center pb-6"><span class="f6 text-gray-light"></span></div></div><script crossorigin=anonymous type=application/javascript src=https://suihan74.github.io/js/frameworks.js></script><script crossorigin=anonymous async type=application/javascript src=https://suihan74.github.io/js/github-bootstrap.js></script><script>let classs=['pinned-item-desc','text-gray','text-small','d-block','mt-2','mb-3'];const pinned_posts=document.getElementsByName('pinned-post');for(let i=0;i<pinned_posts.length;i++){for(let j=0;j<classs.length;j++){const ps=pinned_posts[i].getElementsByTagName('p');for(let k=0;k<ps.length;k++){ps[k].classList.add(classs[j]);}}}
classs=['d-inline-block','text-gray','mb-2','pr-4'];const posts_posts=document.getElementsByName('posts-post');for(let i=0;i<posts_posts.length;i++){for(let j=0;j<classs.length;j++){const ps=posts_posts[i].getElementsByTagName('p');for(let k=0;k<ps.length;k++){ps[k].classList.add(classs[j]);}}}</script></body></html>