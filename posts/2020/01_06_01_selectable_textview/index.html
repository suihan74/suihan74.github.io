<!doctype html><html lang=ja><head><meta charset=utf-8><link crossorigin=anonymous media=all rel=stylesheet href=https://suihan74.github.io/css/frameworks.css?20200203205653><link crossorigin=anonymous media=all rel=stylesheet href=https://suihan74.github.io/css/github.css?20200203205653><link crossorigin=anonymous media=all rel=stylesheet href=https://suihan74.github.io/css/user.css?20200203205653><meta name=viewport content="width=device-width"><title>LinkMovementMethodを設定したTextViewの文字列選択を解除するとクラッシュする - すいはんぶろぐ.io</title><meta property="og:url" content="https://suihan74.github.io/posts/2020/01_06_01_selectable_textview/"><meta property="og:site_name" content="すいはんぶろぐ.io"><meta property="og:type" content="article"><meta property="og:title" content="LinkMovementMethodを設定したTextViewの文字列選択を解除するとクラッシュする"><meta property="og:description" content="LinkMovementMethodを設定したTextViewを文字列選択して解除するとクラッシュする問題をdispatchTouchEvent()を弄ることで回避する。"><meta name=description content="LinkMovementMethodを設定したTextViewを文字列選択して解除するとクラッシュする問題をdispatchTouchEvent()を弄ることで回避する。"><link rel=icon type=image/x-icon class=js-site-favicon href=favicon.ico><link rel="shortcut icon" href=favicon.ico><meta name=theme-color content="#1e2327"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-71542625-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-71542625-2');</script></head><body class="env-production emoji-size-boost page-responsive page-profile"><div class="position-relative js-header-wrapper"><span class="Progress progress-pjax-loader position-fixed width-full js-pjax-loader-bar"><span class="progress-pjax-loader-bar top-0 left-0" style=width:0%></span></span><div class="Header js-details-container Details flex-wrap flex-lg-nowrap p-responsive" role=banner><div class="Header-item d-none d-lg-flex"><a class=Header-link href=https://suihan74.github.io/ aria-label=Homepage data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" width="32" aria-hidden="true"><path style="fill-rule:evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.077797-1.481017-.077797-2.151017C5.9433346 12.597005 6.1160655 11.824118 6.56 11.53 4.78 11.33 3.8013559 10.978983 3.5810169 7.6647458 3.9355372 4.6446549 5.3653277 3.8240736 8.0538984 3.639661 10.967753 3.8102868 12.141357 4.4459308 12.425085 7.6477967 12.255593 10.378813 11.25 11.33 9.47 11.53c.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38C13.806446 14.490656 15.999121 11.437004 16 8c0-4.42-3.58-8-8-8z" /><rect style="fill-rule:evenodd" ry=".23728813" y="6.3898306" x="6.0169492" height="1.0847455" width="3.9830508"/></svg><span style=margin-left:8px>すいはんぶろぐ.io</span></a></div><div class="Header-item Header-item--full flex-column flex-lg-row width-full flex-order-2 flex-lg-order-none mr-0 mr-lg-3 mt-3 mt-lg-0 Details-content--hidden"><div class="header-search flex-self-stretch flex-lg-self-auto mr-0 mr-lg-3 mb-3 mb-lg-0 scoped-search site-scoped-search js-site-search position-relative js-jump-to" role=combobox aria-owns=jump-to-results aria-label="Search or jump to" aria-haspopup=listbox aria-expanded=false><div class=position-relative></div></div></div><div class="Header-item Header-item--full flex-justify-center d-lg-none position-relative" style=margin-right:auto><a class=Header-link href=https://suihan74.github.io/ aria-label=Homepage data-ga-click="Header, go to dashboard, icon:logo"><svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" width="32" aria-hidden="true"><path style="fill-rule:evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.077797-1.481017-.077797-2.151017C5.9433346 12.597005 6.1160655 11.824118 6.56 11.53 4.78 11.33 3.8013559 10.978983 3.5810169 7.6647458 3.9355372 4.6446549 5.3653277 3.8240736 8.0538984 3.639661 10.967753 3.8102868 12.141357 4.4459308 12.425085 7.6477967 12.255593 10.378813 11.25 11.33 9.47 11.53c.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38C13.806446 14.490656 15.999121 11.437004 16 8c0-4.42-3.58-8-8-8z" /><rect style="fill-rule:evenodd" ry=".23728813" y="6.3898306" x="6.0169492" height="1.0847455" width="3.9830508"/></svg>すいはんぶろぐ.io</a></div><div class="Header-item position-relative mr-0 d-none d-lg-flex Details-content--hidden"><div class="header-search flex-self-stretch flex-lg-self-auto mr-0 mr-lg-3 mb-3 mb-lg-0 position-relative js-jump-to"><div class=position-relative><form class=js-site-search-form role=search action=https://cse.google.com/cse method=get><input type=hidden name=cx value=006598476776954487838:x6qvcxfxgqt>
<label class="form-control input-sm header-search-wrapper p-0 header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center js-chromeless-input-container"><input type=text class="form-control input-sm header-search-input" name=q placeholder=Search autocapitalize=off aria-label=Search spellcheck=false onkeydown="if(event.keyCode==13){if(this.value.length){document.getElementById('header-search-submit').click();return false}else{return false}};" autocomplete=off>
<button id=header-search-submit class="mr-1 ml-1 header-search-button" type=submit><svg class="header-search-button-icon" width="13" height="13" viewBox="0 0 13 13"><title>サイト内検索</title><path d="m4.8495 7.8226c.82666.0 1.5262-.29146 2.0985-.87438.57232-.58292.86378-1.2877.87438-2.1144.010599-.82666-.28086-1.5262-.87438-2.0985-.59352-.57232-1.293-.86378-2.0985-.87438-.8055-.010599-1.5103.28086-2.1144.87438-.60414.59352-.8956 1.293-.87438 2.0985.021197.8055.31266 1.5103.87438 2.1144.56172.60414 1.2665.8956 2.1144.87438zm4.4695.2115 3.681 3.6819-1.259 1.284-3.6817-3.7.0019784-.69479-.090043-.098846c-.87973.76087-1.92 1.1413-3.1207 1.1413-1.3553.0-2.5025-.46363-3.4417-1.3909s-1.4088-2.0686-1.4088-3.4239.4696-2.4966 1.4088-3.4239c.9392-.92727 2.0864-1.3969 3.4417-1.4088 1.3553-.011889 2.4906.45771 3.406 1.4088.9154.95107 1.379 2.0924 1.3909 3.4239.0 1.2126-.38043 2.2588-1.1413 3.1385l.098834.090049z"/></svg></button></label></form></div></div></div></header></div><div id=start-of-content class=show-on-focus></div><div id=js-flash-container></div><div class=application-main data-commit-hovercards-enabled><div itemscope itemtype=http://schema.org/SoftwareSourceCode><main id=js-repo-pjax-container data-pjax-container><div class="pagehead repohead instapaper_ignore readability-menu experiment-repo-nav pt-lg-4"><div class="repohead-details-container clearfix container-lg p-responsive d-lg-block"><div class="mb-3 d-flex"><h1 class="public css-truncate float-none flex-auto width-fit pl-0"><a class="avatar mr-1" href=https://suihan74.github.io/about/><img src=/images/author.png width=26 height=26></a>
<span class=author><a href=https://suihan74.github.io/about/>すいはん</a></span>
<span class=path-divider>/</span>
<strong itemprop=name><a href=https://suihan74.github.io/posts/2020/01_06_01_selectable_textview/>LinkMovementMethodを設定したTextViewの文字列選択を解除するとクラッシュする</a></strong><div class="text-small text-gray">LinkMovementMethodを設定したTextViewを文字列選択して解除するとクラッシュする問題をdispatchTouchEvent()を弄ることで回避する。</div><div class="text-small text-gray"><svg class="octicon octicon-tag" viewBox="0 0 14 16" width="14" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.73 1.73C7.26 1.26 6.62 1 5.96 1H3.5C2.13 1 1 2.13 1 3.5v2.47c0 .66.27 1.3.73 1.77l6.06 6.06c.39.39 1.02.39 1.41.0l4.59-4.59a.996.996.0 000-1.41L7.73 1.73zM2.38 7.09c-.31-.3-.47-.7-.47-1.13V3.5c0-.88.72-1.59 1.59-1.59h2.47c.42.0.83.16 1.13.47l6.14 6.13-4.73 4.73-6.13-6.15zM3.01 3h2v2H3V3h.01z" /></svg><a href=/tags/android/>android</a> <a href=/tags/kotlin/>kotlin</a> <a href=/tags/view/>view</a></div><div class="d-block text-small text-gray">Created at <time datetime="2020-01-06 02:49" class=no-wrap>2020/01/06 02:49</time></div></h1></div></div></div><div class="container-lg clearfix new-discussion-timeline experiment-repo-nav p-responsive"><div class=repository-content><div class="Box mt-3 position-relative"><div class="Box-header py-2 d-flex flex-column flex-shrink-0 flex-md-row flex-md-items-center"><div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">1487 Words</div><div class="d-flex py-1 py-md-0 flex-auto flex-order-1 flex-md-order-2 flex-sm-grow-0 flex-justify-between"><div class=BtnGroup><a rel=nofollow class="btn btn-sm BtnGroup-item" href=https://github.com/suihan74/hugo_files/commits/master/content/posts/2020/01_06_01_selectable_textview.md>History</a></div></div></div><div id=readme class="Box-body readme blob instapaper_body js-code-block-container"><article class="markdown-body entry-content p-3 p-md-6" itemprop=text><h1 id=問題>問題</h1><p>以下の条件の<code>TextView</code>を用意する。</p><ul><li><code>movementMethod</code>に<code>LinkMovementMethod</code>を設定する。</li><li><code>android:textIsSelectable="true"</code>を設定する。</li></ul><p>そして以下の手順で操作を行うと、アプリがクラッシュする。</p><ol><li>該当<code>TextView</code>の文字列を選択する。</li><li><code>TextView</code>上の適当な領域をタップして文字列選択を解除する。</li><li>破滅する。</li></ol><p>ちなみに、<br><code>LinkMovementMethod</code>の<code>return super.onTouchEvent(...)</code>の部分にブレークポイントを置いてから文字列選択解除すると発生しなくてなんやねんってなった。</p><p>また、解除時のタップは単押し長押しに関わらずとにかく<code>MotionEvent.ACTION_DOWN</code>がきた時点で駄目っぽかった。</p><h2 id=様子>様子</h2><p><img src=/images/2020/01_06_01_01.gif alt=様子 title=様子アニメーション></p><h2 id=ログ>ログ</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>java<span style=color:#f92672>.</span><span style=color:#a6e22e>lang</span><span style=color:#f92672>.</span><span style=color:#a6e22e>IllegalArgumentException</span><span style=color:#f92672>:</span> Invalid offset<span style=color:#f92672>:</span> <span style=color:#f92672>-</span>1<span style=color:#f92672>.</span> Valid range is <span style=color:#f92672>[</span>0<span style=color:#f92672>,</span> 16<span style=color:#f92672>]</span>
    at android<span style=color:#f92672>.</span><span style=color:#a6e22e>text</span><span style=color:#f92672>.</span><span style=color:#a6e22e>method</span><span style=color:#f92672>.</span><span style=color:#a6e22e>WordIterator</span><span style=color:#f92672>.</span><span style=color:#a6e22e>checkOffsetIsValid</span><span style=color:#f92672>(</span>WordIterator<span style=color:#f92672>.</span><span style=color:#a6e22e>java</span><span style=color:#f92672>:</span>380<span style=color:#f92672>)</span>
    at android<span style=color:#f92672>.</span><span style=color:#a6e22e>text</span><span style=color:#f92672>.</span><span style=color:#a6e22e>method</span><span style=color:#f92672>.</span><span style=color:#a6e22e>WordIterator</span><span style=color:#f92672>.</span><span style=color:#a6e22e>isBoundary</span><span style=color:#f92672>(</span>WordIterator<span style=color:#f92672>.</span><span style=color:#a6e22e>java</span><span style=color:#f92672>:</span>101<span style=color:#f92672>)</span>
    at android<span style=color:#f92672>.</span><span style=color:#a6e22e>widget</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Editor$SelectionStartHandleView</span><span style=color:#f92672>.</span><span style=color:#a6e22e>positionAtCursorOffset</span><span style=color:#f92672>(</span>Editor<span style=color:#f92672>.</span><span style=color:#a6e22e>java</span><span style=color:#f92672>:</span>4260<span style=color:#f92672>)</span>
    at android<span style=color:#f92672>.</span><span style=color:#a6e22e>widget</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Editor$HandleView</span><span style=color:#f92672>.</span><span style=color:#a6e22e>updatePosition</span><span style=color:#f92672>(</span>Editor<span style=color:#f92672>.</span><span style=color:#a6e22e>java</span><span style=color:#f92672>:</span>3708<span style=color:#f92672>)</span>
    at android<span style=color:#f92672>.</span><span style=color:#a6e22e>widget</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Editor$PositionListener</span><span style=color:#f92672>.</span><span style=color:#a6e22e>onPreDraw</span><span style=color:#f92672>(</span>Editor<span style=color:#f92672>.</span><span style=color:#a6e22e>java</span><span style=color:#f92672>:</span>2507<span style=color:#f92672>)</span>
    at android<span style=color:#f92672>.</span><span style=color:#a6e22e>view</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ViewTreeObserver</span><span style=color:#f92672>.</span><span style=color:#a6e22e>dispatchOnPreDraw</span><span style=color:#f92672>(</span>ViewTreeObserver<span style=color:#f92672>.</span><span style=color:#a6e22e>java</span><span style=color:#f92672>:</span>944<span style=color:#f92672>)</span>
    at android<span style=color:#f92672>.</span><span style=color:#a6e22e>view</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ViewRootImpl</span><span style=color:#f92672>.</span><span style=color:#a6e22e>performTraversals</span><span style=color:#f92672>(</span>ViewRootImpl<span style=color:#f92672>.</span><span style=color:#a6e22e>java</span><span style=color:#f92672>:</span>2055<span style=color:#f92672>)</span>
    at android<span style=color:#f92672>.</span><span style=color:#a6e22e>view</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ViewRootImpl</span><span style=color:#f92672>.</span><span style=color:#a6e22e>doTraversal</span><span style=color:#f92672>(</span>ViewRootImpl<span style=color:#f92672>.</span><span style=color:#a6e22e>java</span><span style=color:#f92672>:</span>1107<span style=color:#f92672>)</span>
    at android<span style=color:#f92672>.</span><span style=color:#a6e22e>view</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ViewRootImpl$TraversalRunnable</span><span style=color:#f92672>.</span><span style=color:#a6e22e>run</span><span style=color:#f92672>(</span>ViewRootImpl<span style=color:#f92672>.</span><span style=color:#a6e22e>java</span><span style=color:#f92672>:</span>6013<span style=color:#f92672>)</span>
    at android<span style=color:#f92672>.</span><span style=color:#a6e22e>view</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Choreographer$CallbackRecord</span><span style=color:#f92672>.</span><span style=color:#a6e22e>run</span><span style=color:#f92672>(</span>Choreographer<span style=color:#f92672>.</span><span style=color:#a6e22e>java</span><span style=color:#f92672>:</span>858<span style=color:#f92672>)</span>
    at android<span style=color:#f92672>.</span><span style=color:#a6e22e>view</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Choreographer</span><span style=color:#f92672>.</span><span style=color:#a6e22e>doCallbacks</span><span style=color:#f92672>(</span>Choreographer<span style=color:#f92672>.</span><span style=color:#a6e22e>java</span><span style=color:#f92672>:</span>670<span style=color:#f92672>)</span>
    at android<span style=color:#f92672>.</span><span style=color:#a6e22e>view</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Choreographer</span><span style=color:#f92672>.</span><span style=color:#a6e22e>doFrame</span><span style=color:#f92672>(</span>Choreographer<span style=color:#f92672>.</span><span style=color:#a6e22e>java</span><span style=color:#f92672>:</span>606<span style=color:#f92672>)</span>
    at android<span style=color:#f92672>.</span><span style=color:#a6e22e>view</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Choreographer$FrameDisplayEventReceiver</span><span style=color:#f92672>.</span><span style=color:#a6e22e>run</span><span style=color:#f92672>(</span>Choreographer<span style=color:#f92672>.</span><span style=color:#a6e22e>java</span><span style=color:#f92672>:</span>844<span style=color:#f92672>)</span>
    at android<span style=color:#f92672>.</span><span style=color:#a6e22e>os</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Handler</span><span style=color:#f92672>.</span><span style=color:#a6e22e>handleCallback</span><span style=color:#f92672>(</span>Handler<span style=color:#f92672>.</span><span style=color:#a6e22e>java</span><span style=color:#f92672>:</span>739<span style=color:#f92672>)</span>
    at android<span style=color:#f92672>.</span><span style=color:#a6e22e>os</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Handler</span><span style=color:#f92672>.</span><span style=color:#a6e22e>dispatchMessage</span><span style=color:#f92672>(</span>Handler<span style=color:#f92672>.</span><span style=color:#a6e22e>java</span><span style=color:#f92672>:</span>95<span style=color:#f92672>)</span>
    at android<span style=color:#f92672>.</span><span style=color:#a6e22e>os</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Looper</span><span style=color:#f92672>.</span><span style=color:#a6e22e>loop</span><span style=color:#f92672>(</span>Looper<span style=color:#f92672>.</span><span style=color:#a6e22e>java</span><span style=color:#f92672>:</span>148<span style=color:#f92672>)</span>
    at android<span style=color:#f92672>.</span><span style=color:#a6e22e>app</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ActivityThread</span><span style=color:#f92672>.</span><span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>ActivityThread<span style=color:#f92672>.</span><span style=color:#a6e22e>java</span><span style=color:#f92672>:</span>5417<span style=color:#f92672>)</span>
    at java<span style=color:#f92672>.</span><span style=color:#a6e22e>lang</span><span style=color:#f92672>.</span><span style=color:#a6e22e>reflect</span><span style=color:#f92672>.</span><span style=color:#a6e22e>Method</span><span style=color:#f92672>.</span><span style=color:#a6e22e>invoke</span><span style=color:#f92672>(</span>Native Method<span style=color:#f92672>)</span>
    at com<span style=color:#f92672>.</span><span style=color:#a6e22e>android</span><span style=color:#f92672>.</span><span style=color:#a6e22e>internal</span><span style=color:#f92672>.</span><span style=color:#a6e22e>os</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ZygoteInit$MethodAndArgsCaller</span><span style=color:#f92672>.</span><span style=color:#a6e22e>run</span><span style=color:#f92672>(</span>ZygoteInit<span style=color:#f92672>.</span><span style=color:#a6e22e>java</span><span style=color:#f92672>:</span>726<span style=color:#f92672>)</span>
    at com<span style=color:#f92672>.</span><span style=color:#a6e22e>android</span><span style=color:#f92672>.</span><span style=color:#a6e22e>internal</span><span style=color:#f92672>.</span><span style=color:#a6e22e>os</span><span style=color:#f92672>.</span><span style=color:#a6e22e>ZygoteInit</span><span style=color:#f92672>.</span><span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>ZygoteInit<span style=color:#f92672>.</span><span style=color:#a6e22e>java</span><span style=color:#f92672>:</span>616<span style=color:#f92672>)</span>
</code></pre></div><p>「オフセット: -1を選択しようとしてますね」じゃねぇんじゃ。</p><p>コールバックとかで呼ばれてエラー発生個所までの間にユーザーコード出てこないやつ割と困る。</p><p>なお、この様子gifアニメーションのように<code>TextView.customSelectionActionModeCallback</code>を設定して文字列選択を監視していると、そちらにも<code>selectionStart = -1</code>とか<code>selectionEnd = -1</code>とかの値が入ってくる。やめてほしい。</p><h1 id=解決方法>解決方法</h1><p><a href=https://stackoverflow.com/questions/33821008/illegalargumentexception-while-selecting-text-in-android-textview/43290390#43290390>IllegalArgumentException while selecting text in Android TextView - Stack Overflow</a></p><p>阪本さんアイコンの人が対処方法を見つけていたので集合知すごいという感じだ。</p><p>次のようなカスタムビューを作成して、<code>TextView</code>の代わりに使用する</p><h2 id=selectabletextviewkt>SelectableTextView.kt</h2><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kt data-lang=kt><span style=color:#66d9ef>package</span> com.suihan74.utilities

<span style=color:#66d9ef>import</span> android.content.Context
<span style=color:#66d9ef>import</span> android.util.AttributeSet
<span style=color:#66d9ef>import</span> android.view.MotionEvent
<span style=color:#66d9ef>import</span> androidx.appcompat.widget.AppCompatTextView

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SelectableTextView</span> : AppCompatTextView {
    <span style=color:#66d9ef>constructor</span>(context: Context, attributeSet: AttributeSet? = <span style=color:#66d9ef>null</span>) :
            <span style=color:#66d9ef>super</span>(context, attributeSet)

    <span style=color:#66d9ef>constructor</span>(context: Context, attributeSet: AttributeSet?, defStyleAttr: Int) :
            <span style=color:#66d9ef>super</span>(context, attributeSet, defStyleAttr)

    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>dispatchTouchEvent</span>(event: MotionEvent?): Boolean {
        <span style=color:#66d9ef>if</span> (selectionStart != selectionEnd &amp;&amp; event<span style=color:#f92672>?.</span>actionMasked == MotionEvent.ACTION_DOWN) {
            text = text
        }
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>super</span>.dispatchTouchEvent(event)
    }
}
</code></pre></div><p><code>text = text</code>の部分が肝心のようで、これだけ見ると何やってんのこの人って感じだけれども、とにかく一度<code>setText(...)</code>を呼ぶことで内部状態がクリアされるのか何なのかで「カーソル位置が-1」みたいなよくわからない状態は回避される。</p><p><code>setText(...)</code>の中身を深掘りするのはまた今度暇と元気があったらというかなんというか。する必要はとくに感じないわけで。</p><h1 id=余談>余談</h1><p>リンク先で「<code>TextView</code>じゃなくて<code>AppCompatTextView</code>使った方がいいよ」と言ってる人がいたので、二者の違いをよく知らなかったから調べた。</p><p><a href=https://developer.android.com/reference/android/support/v7/widget/AppCompatTextView>AppCompatTextView - Android Developers</a></p><p>古いバージョンの端末で動かしている場合にbackground tintingやらauto sizingやらが働かないので、その場合には明示的に<code>AppCompatTextView</code>を使用する必要があるみたいなことが書いてある。</p><p><a href=https://vividcode.hatenablog.com/entry/android-app/library/v7-appcompat-compatible-widget-inflation>【v7 appcompat library を読む】 レイアウト XML のインフレート時に各種 view が compatible widget に変換される仕組み - ひだまりソケットは壊れない</a></p><p>また、<code>AppCompatActivity</code>などで使用する場合においてはレイアウトファイル側で<code>TextView</code>と記述していてもinflate時に自動的に<code>AppCompatTextView</code>に置換してくれるらしいので、とくに明示的に使用する必要はない。</p><p>ただし、<code>LayoutInflater</code>でのinflateを介さない他のすべての場合では明示的に使用する必要がある。<br>つまり今回のように<code>TextView</code>を継承したカスタムビューを作成するなどの場合には<code>TextView</code>ではなく<code>AppCompatTextView</code>を継承する必要があるということらしい。<br>これは他の<code>AppCompatナンタラ</code>なViewすべてに共通か。</p></article></div></div></div></div></main></div></div><div class=utterances></div><script src=https://utteranc.es/client.js repo=suihan74.github.io issue-term=title theme=github-light crossorigin=anonymous async></script><div class="footer container-lg width-full p-responsive" role=contentinfo><div class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light"><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"><li class="mr-3 mr-lg-0">© 2020 すいはん. Theme by <a href=https://github.com/MeiK2333/github-style><span>github-style</span></a> (<a href=https://github.com/suihan74/github-style><span>customized</span></a>)</li></ul><a aria-label=Homepage title=すいはんぶろぐ.io class="footer-octicon d-none d-lg-block mx-lg-4" href=https://suihan74.github.io/><svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" width="24" aria-hidden="true"><path style="fill-rule:evenodd" d="M8 0C3.58.0.0 3.58.0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38.0-.19-.077797-1.481017-.077797-2.151017C5.9433346 12.597005 6.1160655 11.824118 6.56 11.53 4.78 11.33 3.8013559 10.978983 3.5810169 7.6647458 3.9355372 4.6446549 5.3653277 3.8240736 8.0538984 3.639661 10.967753 3.8102868 12.141357 4.4459308 12.425085 7.6477967 12.255593 10.378813 11.25 11.33 9.47 11.53c.29.25.54.73.54 1.48.0 1.07-.01 1.93-.01 2.2.0.21.15.46.55.38C13.806446 14.490656 15.999121 11.437004 16 8c0-4.42-3.58-8-8-8z" /><rect style="fill-rule:evenodd" ry=".23728813" y="6.3898306" x="6.0169492" height="1.0847455" width="3.9830508"/></svg></a><ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0"></ul></div><div class="d-flex flex-justify-center pb-6"><span class="f6 text-gray-light"></span></div></div><script crossorigin=anonymous type=application/javascript src=https://suihan74.github.io/js/frameworks.js></script><script crossorigin=anonymous async type=application/javascript src=https://suihan74.github.io/js/github-bootstrap.js></script><script>let classs=['pinned-item-desc','text-gray','text-small','d-block','mt-2','mb-3'];const pinned_posts=document.getElementsByName('pinned-post');for(let i=0;i<pinned_posts.length;i++){for(let j=0;j<classs.length;j++){const ps=pinned_posts[i].getElementsByTagName('p');for(let k=0;k<ps.length;k++){ps[k].classList.add(classs[j]);}}}
classs=['d-inline-block','text-gray','mb-2','pr-4'];const posts_posts=document.getElementsByName('posts-post');for(let i=0;i<posts_posts.length;i++){for(let j=0;j<classs.length;j++){const ps=posts_posts[i].getElementsByTagName('p');for(let k=0;k<ps.length;k++){ps[k].classList.add(classs[j]);}}}</script></body></html>