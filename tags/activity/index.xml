<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>activity on すいはんぶろぐ.io</title>
    <link>https://suihan74.github.io/tags/activity/</link>
    <description>Recent content in activity on すいはんぶろぐ.io</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja</language>
    <lastBuildDate>Wed, 15 Jan 2020 01:30:40 +0900</lastBuildDate>
    
	<atom:link href="https://suihan74.github.io/tags/activity/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>ダイアログ化したActivityの外側タップを検知する</title>
      <link>https://suihan74.github.io/posts/2020/01_15_00_app_dialog_theme_click_outside/</link>
      <pubDate>Wed, 15 Jan 2020 01:30:40 +0900</pubDate>
      
      <guid>https://suihan74.github.io/posts/2020/01_15_00_app_dialog_theme_click_outside/</guid>
      <description>Activityをダイアログ表示する android:themeに@style/AppDialogThemeを設定したActivityはダイアログとして表示される。(以下DialogActivityと呼称することにする)
次のはSatenaのブクマ投稿画面を抜粋。
AndroidManifest.xml 62 63 64 65 66  &amp;lt;activity android:name=&amp;#34;.scenes.post2.BookmarkPostActivity&amp;#34; android:theme=&amp;#34;@style/AppDialogTheme&amp;#34;&amp;gt; ... &amp;lt;/activity&amp;gt;   様子 Activityは最前面にダイアログ表示されている。
ダイアログ外側をタップで閉じる DialogActivityの外側は暗くなっていて、この部分をタップするとDialogActivityが閉じて、その下に表示されている画面に処理が戻る。
DialogActivityが何らかの結果を呼び出し元に返すことを期待している場合などに、この「外側タップしてからダイアログが閉じるまでの間」に処理を追加したい、というのが今回の内容である。
関連記事 結果を返すActivityを呼ぶ
閉じる前に処理を追加する onTouchEvent(...)はダイアログ外側のタップにも反応する。
タップされた位置からDialogActivityの外側であることを判別するようにするのが楽そうな解決策だった。
DialogActivity.kt override fun onTouchEvent(event: MotionEvent?): Boolean { // Activityの外側をタップして閉じる際に、結果を渡しておく  if (event?.action == MotionEvent.ACTION_DOWN &amp;amp;&amp;amp; isOutOfBounds(event)) { val intent = Intent().apply { putExtra(RESULT_HOGE, viewModel.hoge.value) } setResult(RESULT_CANCELED, intent) } return super.onTouchEvent(event) } /** Activityの外側をタップしたかを判別する */ private fun isOutOfBounds(event: MotionEvent): Boolean { val x = event.</description>
    </item>
    
    <item>
      <title>結果を返すActivityを呼ぶ</title>
      <link>https://suihan74.github.io/posts/2020/01_07_00_start_activity_for_result/</link>
      <pubDate>Tue, 07 Jan 2020 03:02:05 +0900</pubDate>
      
      <guid>https://suihan74.github.io/posts/2020/01_07_00_start_activity_for_result/</guid>
      <description>Activityから戻ってくる際にその結果を受け取る必要がある場合のやりかた。
こういうネタ何書いても今さら感しかないわけだけど、しかし作っているもの的にこれまであまり必要なシーンも無かったので、備忘。
1. 結果を返すActivityの呼び方 startActivity(intent)の代わりにstartActivityForResult(intent: Intent, requestCode: Int)を使用する。
startActivityForResult(intent, HogeActivity.REQUEST_CODE) requestCodeはInt型だが16bit範囲内の値である必要がある1。
これを守らないとIllegalArgumentException投げられる。
定数値以外を使う場合0xffffでマスクするなりしてナントカする。
Fragmentから呼んで、返ってきた結果をActivityで処理する場合 Fragment.startActivityForResult(...)を使用するとActivity.onActivityResult(...)に渡されるrequestCodeが意図しないものになる。
以下のどちらかで対応。
 Activityで結果を受け取りたいならactivity?.startActivityForResult(...)とかに書き換える。 Fragment.onActivityResult(...)で受け取る。  2. Activityから結果を返して終了する Activity.finish()を呼ぶ前にresultCodeと結果を返すためのIntentをセットする。
val intent = Intent().apply { putExtra(RESULT_DATA, result) } setResult(Activity.RESULT_OK, intent) finish() 成功ならActivity.RESULT_OK、失敗ならActivity.RESULT_CANCELEDがあるのでそれを使えばそれで良い気がする。
何も指定しないとActivity.RESULT_CANCELEDが返ってくるっぽい。
3. 返ってきた結果を受け取る override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) { super.onActivityResult(requestCode, resultCode, data) when (requestCode) { HogeActivity.REQUEST_CODE -&amp;gt; { when (resultCode) { Activity.RESULT_OK -&amp;gt; { val result = data?.getSerializableExtra(HogeActivity.RESULT_DATA) as? HogeResult ... } Activity.</description>
    </item>
    
  </channel>
</rss>